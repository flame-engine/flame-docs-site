<!DOCTYPE html>
<html lang="en">
<head>
<meta name="robots" content="noindex">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>3. Building the World &#8212; Flame</title>
  <!-- Stylesheets -->
  <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b20cc3f5" />
  <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=eeb27264" />
  <link rel="stylesheet" type="text/css" href="../../_static/dart_domain.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/flutter_app.css?v=6984c178" />
  <link rel="stylesheet" type="text/css" href="../../_static/package.css?v=7889e545" />
  <link rel="stylesheet" type="text/css" href="../../_static/yarn_lexer.css?v=932ca0ec" />
  <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
  <link rel="stylesheet" type="text/css" href="../../_static/flames.css?v=ac7bdd72" />
  <link rel="stylesheet" type="text/css" href="../../_static/copy-button.css?v=deecb4da" />
  <!-- Scripts -->
  <script src="../../_static/jquery.js?v=5d32c60e"></script>
  <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
  <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
  <script src="../../_static/doctools.js?v=0b60eaae"></script>
  <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
  <script src="../../_static/flutter_app.js?v=3619378f"></script>
  <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
  <script src="../../_static/copybutton.js?v=f281be69"></script>
  <script src="../../_static/versions.js?v=58484017"></script>
  <script src="../../_static/menu-expand.js?v=8e297497"></script>
  <!--script src="searchindex.js" defer></script-->
  <script src="https://cdn.jsdelivr.net/npm/virtual-webgl"></script>
  <!-- Links -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,400;0,700;1,400;1,700&display=swap">
  <link rel="preload" as="font" type="font/woff2" crossorigin="" href="../../_static/fontawesome/fa-brands-400.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin="" href="../../_static/fontawesome/fa-solid-900.woff2">
  <link rel="stylesheet" href="../../_static/fontawesome/all.min.css">
  <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="next" title="4. Adding the Remaining Components" href="step_4.html" />
  <link rel="prev" title="2. Start Coding" href="step_2.html" />
</head>

<body data-spy="scroll" data-target="#toc-local" data-offset="80">

<div class="top-bar">
  <button id="menu-button" class="btn" title="Toggle menu"><i class="fa fa-bars"></i></button>
  <script type="text/javascript">
    jQuery(function(){
      $("#menu-button").click(function() {
        $(this).toggleClass("active");
        $(".sidebar-left-area").toggleClass("active");
      });

      $('div.nav-left li > a:not(:only-child)').wrap('<div class=submenu></div>');
      $('div.nav-left div.submenu').prepend('<a class=arrow>&nbsp;</a>');
      $('div.nav-left div.submenu > a.arrow')
        .click(function() {
          $(this.parentElement.parentElement).toggleClass('current');
        });

      // This function ensures that when navigating to internal targets within the page (such as
      // a section header), those targets will be visible to the user and not obscured by the menu
      // bar at the top of the page.
      function scrollToHashTarget() {
        if (location.hash !== location.oldHash) {
          window.scrollBy(0, -60);
          location.oldHash = location.hash;
        }
      }
      window.location.oldHash = '';
      window.addEventListener('hashchange', scrollToHashTarget);
      scrollToHashTarget();
    });
  </script>

  <a href="../../index.html" class="logo_image" aria-label="Navigate to home page">
    <img src="../../_static/logo_flame.png" alt="Flame logo: a fiery symbol along with the FLAME wordmark.">
  </a>  
  <div class="highlight-box" role="alert" style="display:none">
    <div>
      <div class="title">highlighted:</div>
      <div class="content" id="highlight-content"></div>
    </div>
    <button type="button" class="close" data-dismiss="alert" aria-label="Dismiss">×</button>
  </div>
  <div class="expander"></div>

  <div class="versions-placeholder"></div>
  <a href="https://discord.com/invite/pxrBmy4" id="discord-button" class="btn"
     title="Blue Fire Discord server">
    <i class="fab fa-discord"></i>
  </a>
  <a href="https://github.com/flame-engine/flame/" id="github-button" class="btn"
     title="GitHub repository">
    <i class="fab fa-github"></i>
  </a>
</div>

<div class="sidebar-left-area">
  <div class="sidebar-left-bg"></div>
  <div class="sidebar-left">
    <div class="searchbox" role="search">
      <form id="search-form" action="../../search.html" method="get">
        <i class="icon fa fa-search"></i>
        <input type="search" class="form-control" id="search-input" name="q"
               placeholder="Search the docs..." autocomplete="off" />
      </form>
    </div>
    <div class="nav-left" role="navigation" aria-label="Main">
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../flame/flame.html">Flame</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../README.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/game_widget.html">Game Widget</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/game.html">The game class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/structure.html">Assets Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/components.html">Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/inputs/inputs.html">Inputs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../flame/inputs/tap_events.html">Tap Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/inputs/drag_events.html">Drag Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/inputs/gesture_input.html">Gesture Input</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/inputs/keyboard_input.html">Keyboard Input</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/inputs/other_inputs.html">Other Inputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/inputs/pointer_events.html">Pointer Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/inputs/hardware_keyboard_detector.html">HardwareKeyboardDetector</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/camera.html">Camera</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/effects/effects.html">Effects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../flame/effects/effect_controllers.html">Effect Controllers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/effects/move_effects.html">Move Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/effects/rotate_effects.html">Rotate Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/effects/scale_effects.html">Scale Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/effects/size_effects.html">Size Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/effects/anchor_effects.html">Anchor Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/effects/color_effects.html">Color Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/effects/sequence_effect.html">Sequence Effect</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/effects/remove_effect.html">Remove Effect</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/effects/function_effect.html">Function Effect</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/collision_detection.html">Collision Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/router.html">Router</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/platforms.html">Platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/rendering/rendering.html">Rendering</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../flame/rendering/post_processing.html">Post Processing and Shaders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/rendering/palette.html">Colors and Palette</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/rendering/decorators.html">Decorators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/rendering/images.html">Images, Sprites and Animations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/rendering/layers.html">Layers and Snapshots</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/rendering/particles.html">Particles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/rendering/text_rendering.html">Text Rendering</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/layout/layout.html">Layout</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../flame/layout/align_component.html">AlignComponent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/layout/row_component.html">RowComponent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/layout/column_component.html">ColumnComponent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/layout/expanded_component.html">Expanded Component</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/layout/padding_component.html">Padding Component</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/overlays.html">Overlays</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/other/other.html">Other</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../flame/other/debug.html">Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/other/util.html">Utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/other/widgets.html">Widgets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/other/performance.html">Performance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../bridge_packages/bridge_packages.html">Bridge Packages</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../bridge_packages/flame_audio/flame_audio.html">flame_audio</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bridge_packages/flame_audio/audio.html">General audio</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bridge_packages/flame_audio/bgm.html">Background music</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bridge_packages/flame_audio/audio_pool.html">AudioPool</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bridge_packages/flame_behaviors/flame_behaviors.html">flame_behaviors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bridge_packages/flame_behaviors/getting_started.html">Getting Started</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bridge_packages/flame_bloc/flame_bloc.html">flame_bloc</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bridge_packages/flame_bloc/bloc.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bridge_packages/flame_bloc/bloc_components.html">Components</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bridge_packages/flame_fire_atlas/flame_fire_atlas.html">flame_fire_atlas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bridge_packages/flame_fire_atlas/fire_atlas.html">Overview</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bridge_packages/flame_forge2d/flame_forge2d.html">flame_forge2d</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bridge_packages/flame_forge2d/forge2d.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bridge_packages/flame_forge2d/joints.html">Joints</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bridge_packages/flame_isolate/flame_isolate.html">flame_isolate</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bridge_packages/flame_isolate/isolate.html">Overview</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bridge_packages/flame_lottie/flame_lottie.html">flame_lottie</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bridge_packages/flame_network_assets/flame_network_assets.html">flame_network_assets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bridge_packages/flame_oxygen/flame_oxygen.html">flame_oxygen</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bridge_packages/flame_rive/flame_rive.html">flame_rive</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bridge_packages/flame_rive/rive.html">Overview</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bridge_packages/flame_riverpod/flame_riverpod.html">flame_riverpod</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bridge_packages/flame_riverpod/riverpod.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bridge_packages/flame_riverpod/component.html">Component</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bridge_packages/flame_riverpod/widget.html">Widget</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bridge_packages/flame_splash_screen/flame_splash_screen.html">flame_splash_screen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bridge_packages/flame_spine/flame_spine.html">flame_spine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bridge_packages/flame_svg/flame_svg.html">flame_svg</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bridge_packages/flame_svg/svg.html">Overview</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bridge_packages/flame_tiled/flame_tiled.html">flame_tiled</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bridge_packages/flame_tiled/tiled.html">Tiled</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bridge_packages/flame_tiled/layers.html">Layers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../other_modules/other_modules.html">Other Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../other_modules/jenny/jenny.html">jenny</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../other_modules/jenny/language/language.html">YarnSpinner language</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/language/nodes.html">Nodes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/language/lines.html">Lines</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/language/options.html">Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/language/commands/commands.html">Commands</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../other_modules/jenny/language/commands/character.html">&lt;&lt;character&gt;&gt;</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../other_modules/jenny/language/commands/declare.html">&lt;&lt;declare&gt;&gt;</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../other_modules/jenny/language/commands/if.html">&lt;&lt;if&gt;&gt;</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../other_modules/jenny/language/commands/jump.html">&lt;&lt;jump&gt;&gt;</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../other_modules/jenny/language/commands/local.html">&lt;&lt;local&gt;&gt;</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../other_modules/jenny/language/commands/set.html">&lt;&lt;set&gt;&gt;</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../other_modules/jenny/language/commands/stop.html">&lt;&lt;stop&gt;&gt;</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../other_modules/jenny/language/commands/visit.html">&lt;&lt;visit&gt;&gt;</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../other_modules/jenny/language/commands/wait.html">&lt;&lt;wait&gt;&gt;</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../other_modules/jenny/language/commands/user_defined_commands.html">User-defined commands</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/language/expressions/expressions.html">Expressions</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../other_modules/jenny/language/expressions/variables.html">Variables</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../other_modules/jenny/language/expressions/operators.html">Operators</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../other_modules/jenny/language/expressions/functions/functions.html">Functions</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../other_modules/jenny/language/expressions/functions/random.html">Random functions</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../other_modules/jenny/language/expressions/functions/numeric.html">Numeric functions</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../other_modules/jenny/language/expressions/functions/type.html">Type conversion functions</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../other_modules/jenny/language/expressions/functions/misc.html">Miscellaneous functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/language/markup.html">Markup</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../other_modules/jenny/runtime/jenny_runtime.html">Jenny API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/runtime/character.html">Character</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/runtime/character_storage.html">CharacterStorage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/runtime/command_storage.html">CommandStorage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/runtime/dialogue_choice.html">DialogueChoice</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/runtime/dialogue_line.html">DialogueLine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/runtime/dialogue_option.html">DialogueOption</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/runtime/dialogue_runner.html">DialogueRunner</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/runtime/dialogue_view.html">DialogueView</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/runtime/function_storage.html">FunctionStorage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/runtime/markup_attribute.html">MarkupAttribute</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/runtime/node.html">Node</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/runtime/user_defined_command.html">UserDefinedCommand</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/runtime/variable_storage.html">VariableStorage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../other_modules/jenny/runtime/yarn_project.html">YarnProject</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../other_modules/oxygen/oxygen.html">oxygen</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../other_modules/oxygen/components.html">Components</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../bare_flame_game.html">Bare Flame game</a></li>
<li class="toctree-l2"><a class="reference internal" href="../klondike/klondike.html">Klondike</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../klondike/step1.html">1. Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../klondike/step2.html">2. Scaffolding</a></li>
<li class="toctree-l3"><a class="reference internal" href="../klondike/step3.html">3. Cards</a></li>
<li class="toctree-l3"><a class="reference internal" href="../klondike/step4.html">4. Gameplay</a></li>
<li class="toctree-l3"><a class="reference internal" href="../klondike/step5.html">5. Additional features</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="platformer.html">Ember Quest</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="step_1.html">1. Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="step_2.html">2. Start Coding</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">3. Building the World</a></li>
<li class="toctree-l3"><a class="reference internal" href="step_4.html">4. Adding the Remaining Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="step_5.html">5. Controlling Movement</a></li>
<li class="toctree-l3"><a class="reference internal" href="step_6.html">6. Adding the HUD</a></li>
<li class="toctree-l3"><a class="reference internal" href="step_7.html">7. Adding Menus</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../space_shooter/space_shooter.html">Space Shooter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../space_shooter/step_1.html">1. Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="../space_shooter/step_2.html">2. Controlling the player and adding some graphics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../space_shooter/step_3.html">3. Adding animations and depth</a></li>
<li class="toctree-l3"><a class="reference internal" href="../space_shooter/step_4.html">4. Adding Bullets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../space_shooter/step_5.html">5. Adding Enemies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../space_shooter/step_6.html">6. Enemy and Bullet collisions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development/development.html">Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/style_guide.html">Style Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/testing_guide.html">Tests Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/resources.html">Resources</a><ul>
<li class="toctree-l2"><a class="reference external" href="https://pub.dev/documentation/flame/latest/">Flame API</a></li>
<li class="toctree-l2"><a class="reference external" href="https://examples.flame-engine.org/#/">Flame Examples</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
</div>

<div class="main-area">
  <div class="document-wrapper">
    <div class="warning hidden" id="version-warning">
      <p><strong>Warning:</strong> you are currently viewing the docs for an older
      version <span class="version"></span> of Flame.</p>
      <p>Please <a href="/">click here</a> to go see the documentation for the latest
      released version.</p>
    </div>
    <div class="document" role="main">
      
  <section class="tex2jax_ignore mathjax_ignore" id="building-the-world">
<h1>3. Building the World<a class="headerlink" href="#building-the-world" title="Link to this heading">¶</a></h1>
<section id="creating-segments">
<h2>Creating Segments<a class="headerlink" href="#creating-segments" title="Link to this heading">¶</a></h2>
<p>For this world to be infinite, the best way to approach this is to create segments that can be
reloaded over and over. To do this, we need a rough sketch of what our level segments will look
like. I have created the following sketch to show what the segments would look like and how they can
be repeated:</p>
<p><img alt="Level Segment Sketch" src="../../_images/LevelSegmentSketch.jpg" /></p>
<p>Each segment is a 10x10 grid and each block is 64 pixels x 64 pixels. This means Ember Quest has a
height of 640 with an infinite width. In my design, there must always be a ground
block at the beginning and the end. Additionally, there must be at least 3 ground blocks that come
before an enemy, including if the segment wraps to another segment. This is because the plan is to
have the enemies traverse back and forth for 3 blocks. Now that we have a plan for the segments,
let’s create a segment manager class.</p>
<section id="segment-manager">
<h3>Segment Manager<a class="headerlink" href="#segment-manager" title="Link to this heading">¶</a></h3>
<p>To get started, we have to understand that we will be referencing our blocks in the segment manager,
so first create a new folder called <code class="docutils literal notranslate"><span class="pre">lib/objects</span></code>. In that folder, create 3 files called
<code class="docutils literal notranslate"><span class="pre">ground_block.dart</span></code>, <code class="docutils literal notranslate"><span class="pre">platform_block.dart</span></code>, and <code class="docutils literal notranslate"><span class="pre">star.dart</span></code>. Those files just need basic
boilerplate code for the class, so create the following in their respective files:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span><span class="w"> </span><span class="nc">GroundBlock</span><span class="w"> </span><span class="p">{}</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">PlatformBlock</span><span class="w"> </span><span class="p">{}</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">Star</span><span class="w"> </span><span class="p">{}</span>
</pre></div>
</div>
<p>Also, create <code class="docutils literal notranslate"><span class="pre">water_enemy.dart</span></code> in the <code class="docutils literal notranslate"><span class="pre">lib/actors</span></code> folder using this boilerplate code:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span><span class="w"> </span><span class="nc">WaterEnemy</span><span class="w"> </span><span class="p">{}</span>
</pre></div>
</div>
<p>Now we can create a file called <code class="docutils literal notranslate"><span class="pre">segment_manager.dart</span></code> which will be placed in a new folder called
<code class="docutils literal notranslate"><span class="pre">lib/managers</span></code>. The segment manager is the heart and soul, if you will, of Ember Quest. This is
where you can get as creative as you want. You do not have to follow my design, just remember that
whatever you design, the segment must follow the rules outlined above. Add the following code to
<code class="docutils literal notranslate"><span class="pre">segment_manager.dart</span></code>:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span><span class="w"> </span><span class="nc">Block</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// gridPosition position is always segment based X,Y.</span>
<span class="w">  </span><span class="c1">// 0,0 is the bottom left corner.</span>
<span class="w">  </span><span class="c1">// 10,10 is the upper right corner.</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">Vector2</span><span class="w"> </span><span class="n">gridPosition</span><span class="p">;</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="n">blockType</span><span class="p">;</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">gridPosition</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="n">blockType</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">final</span><span class="w"> </span><span class="n">segments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="n">segment0</span><span class="p">,</span>
<span class="p">];</span>

<span class="kd">final</span><span class="w"> </span><span class="n">segment0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>

<span class="p">];</span>
</pre></div>
</div>
<p>So what this does, is allows us to create segments (segment0, segment1, etc) in a list format that
gets added to the <code class="docutils literal notranslate"><span class="pre">segments</span></code> list. The individual segments will be made up of multiple entries of the
<code class="docutils literal notranslate"><span class="pre">Block</span></code> class. This information will allow us to translate the block position from a 10x10 grid to
the actual pixel position in the game world. To create a segment, you need to create
entries for each block that you wish to be rendered from the sketch.</p>
<p>To understand each segment, if we start in the bottom left corner of the grid in the sketch, we see
that we should place a <code class="docutils literal notranslate"><span class="pre">Block()</span></code> in the <code class="docutils literal notranslate"><span class="pre">segment0</span></code> list with a first parameter <code class="docutils literal notranslate"><span class="pre">gridPosition</span></code> of a
<code class="docutils literal notranslate"><span class="pre">Vector2(0,0)</span></code> and a <code class="docutils literal notranslate"><span class="pre">blockType</span></code> of the <code class="docutils literal notranslate"><span class="pre">GroundBlock</span></code> class that we created earlier. Remember, the
very bottom left cell is x=0 and y=0 thus the <code class="docutils literal notranslate"><span class="pre">Vector2(x,y)</span></code> is <code class="docutils literal notranslate"><span class="pre">Vector2(0,0)</span></code>.</p>
<p><img alt="Segment 0 Sketch" src="../../_images/Segment0Sketch.jpg" /></p>
<p>The full segment would look like this:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">final</span><span class="w"> </span><span class="n">segment0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">WaterEnemy</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="p">];</span>
</pre></div>
</div>
<p>Proceed to build the remaining segments. The full segment manager should look like this:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:flame/components.dart&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s1">&#39;../actors/water_enemy.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;../objects/ground_block.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;../objects/platform_block.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;../objects/star.dart&#39;</span><span class="p">;</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">Block</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// gridPosition position is always segment based X,Y.</span>
<span class="w">  </span><span class="c1">// 0,0 is the bottom left corner.</span>
<span class="w">  </span><span class="c1">// 10,10 is the upper right corner.</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">Vector2</span><span class="w"> </span><span class="n">gridPosition</span><span class="p">;</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="n">blockType</span><span class="p">;</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">gridPosition</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="n">blockType</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">final</span><span class="w"> </span><span class="n">segments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="n">segment0</span><span class="p">,</span>
<span class="w">  </span><span class="n">segment1</span><span class="p">,</span>
<span class="w">  </span><span class="n">segment2</span><span class="p">,</span>
<span class="w">  </span><span class="n">segment3</span><span class="p">,</span>
<span class="w">  </span><span class="n">segment4</span><span class="p">,</span>
<span class="p">];</span>

<span class="kd">final</span><span class="w"> </span><span class="n">segment0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">WaterEnemy</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="p">];</span>

<span class="kd">final</span><span class="w"> </span><span class="n">segment1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">),</span><span class="w"> </span><span class="n">Star</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="n">WaterEnemy</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="p">];</span>

<span class="kd">final</span><span class="w"> </span><span class="n">segment2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">WaterEnemy</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">),</span><span class="w"> </span><span class="n">Star</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="p">];</span>

<span class="kd">final</span><span class="w"> </span><span class="n">segment3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">WaterEnemy</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">),</span><span class="w"> </span><span class="n">Star</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="p">];</span>

<span class="kd">final</span><span class="w"> </span><span class="n">segment4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">WaterEnemy</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">),</span><span class="w"> </span><span class="n">Star</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">GroundBlock</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">WaterEnemy</span><span class="p">),</span>
<span class="w">  </span><span class="n">Block</span><span class="p">(</span><span class="n">Vector2</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">PlatformBlock</span><span class="p">),</span>
<span class="p">];</span>
</pre></div>
</div>
</section>
<section id="loading-the-segments-into-the-world">
<h3>Loading the Segments into the World<a class="headerlink" href="#loading-the-segments-into-the-world" title="Link to this heading">¶</a></h3>
<p>Now that our segments are defined, we need to create a way to load these blocks into our world. To
do that, we are going to start work in the <code class="docutils literal notranslate"><span class="pre">ember_quest.dart</span></code> file. We will create a <code class="docutils literal notranslate"><span class="pre">loadSegments</span></code>
method that when given an index for the segments list, will then loop through that segment from
our <code class="docutils literal notranslate"><span class="pre">segment_manager</span></code> and we will add the appropriate blocks later. It should look like this:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">loadGameSegments</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">segmentIndex</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">xPositionOffset</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">segments</span><span class="p">[</span><span class="n">segmentIndex</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">block</span><span class="p">.</span><span class="n">blockType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nl">GroundBlock:</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nl">PlatformBlock:</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nl">Star:</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nl">WaterEnemy:</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
<p>You will need to add the following imports if they were not auto-imported:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;actors/water_enemy.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;managers/segment_manager.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;objects/ground_block.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;objects/platform_block.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;objects/star.dart&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Now we can refactor our game a bit and create an <code class="docutils literal notranslate"><span class="pre">initializeGame()</span></code> method which will call our
<code class="docutils literal notranslate"><span class="pre">loadGameSegments</span></code> method.</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">initializeGame</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Assume that size.x &lt; 3200</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">segmentsToLoad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">640</span><span class="p">).</span><span class="n">ceil</span><span class="p">();</span>
<span class="w">    </span><span class="n">segmentsToLoad</span><span class="p">.</span><span class="n">clamp</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">segments</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">segmentsToLoad</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">loadGameSegments</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="m">640</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="p">).</span><span class="n">toDouble</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">_ember</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EmberPlayer</span><span class="p">(</span>
<span class="w">      </span><span class="nl">position:</span><span class="w"> </span><span class="n">Vector2</span><span class="p">(</span><span class="m">128</span><span class="p">,</span><span class="w"> </span><span class="n">canvasSize</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">70</span><span class="p">),</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">world</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">_ember</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
<p>We simply are taking the width of the game screen, divide that by 640 (10 blocks in a segment times
64 pixels wide for each block), and round that up. As we only defined 5 segments total, we need to
restrict that integer from 0 to the length of the segments list in case the user has a really wide
screen. Then we simply loop through the number of <code class="docutils literal notranslate"><span class="pre">segmentsToLoad</span></code> and call <code class="docutils literal notranslate"><span class="pre">loadGameSegments</span></code> with
the integer to load and then calculate the offset.</p>
<p>Additionally, I have moved the Ember-related code from the <code class="docutils literal notranslate"><span class="pre">onLoad</span></code> method to our new
<code class="docutils literal notranslate"><span class="pre">initializeGame</span></code> method. This means I can now make the call in <code class="docutils literal notranslate"><span class="pre">onLoad</span></code> to <code class="docutils literal notranslate"><span class="pre">initializeGame</span></code> such
as:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="nd">@override</span>
<span class="w">  </span><span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">onLoad</span><span class="p">()</span><span class="w"> </span><span class="kd">async</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">await</span><span class="w"> </span><span class="n">images</span><span class="p">.</span><span class="n">loadAll</span><span class="p">([</span>
<span class="w">      </span><span class="s1">&#39;block.png&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;ember.png&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;ground.png&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;heart_half.png&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;heart.png&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;star.png&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;water_enemy.png&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="p">]);</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">viewfinder</span><span class="p">.</span><span class="n">anchor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Anchor</span><span class="p">.</span><span class="n">topLeft</span><span class="p">;</span>
<span class="w">    </span><span class="n">initializeGame</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
<p>At this point, you probably have errors for all the object classes and the enemy class, but don’t
worry, we will solve those right now.</p>
</section>
<section id="the-platform-block">
<h3>The Platform Block<a class="headerlink" href="#the-platform-block" title="Link to this heading">¶</a></h3>
<p>One of the easiest blocks to start with is the Platform Block. There are two things that we need to
develop beyond getting the sprite to be displayed; that is, we need to place it in the correct
position and as Ember moves across the screen, we need to remove the blocks once they are off the
screen. In Ember Quest, the player can only move forward, so this will keep the game lightweight as
it’s an infinite level.</p>
<p>Open the <code class="docutils literal notranslate"><span class="pre">lib/objects/platform_block.dart</span></code> file and add the following code:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:flame/collisions.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:flame/components.dart&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s1">&#39;../ember_quest.dart&#39;</span><span class="p">;</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">PlatformBlock</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">SpriteComponent</span>
<span class="w">    </span><span class="kd">with</span><span class="w"> </span><span class="n">HasGameReference</span><span class="o">&lt;</span><span class="n">EmberQuestGame</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">Vector2</span><span class="w"> </span><span class="n">gridPosition</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">xOffset</span><span class="p">;</span>

<span class="w">  </span><span class="n">PlatformBlock</span><span class="p">({</span>
<span class="w">    </span><span class="kd">required</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="n">gridPosition</span><span class="p">,</span>
<span class="w">    </span><span class="kd">required</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="n">xOffset</span><span class="p">,</span>
<span class="w">  </span><span class="p">})</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">super</span><span class="p">(</span><span class="nl">size:</span><span class="w"> </span><span class="n">Vector2</span><span class="p">.</span><span class="n">all</span><span class="p">(</span><span class="m">64</span><span class="p">),</span><span class="w"> </span><span class="nl">anchor:</span><span class="w"> </span><span class="n">Anchor</span><span class="p">.</span><span class="n">bottomLeft</span><span class="p">);</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">onLoad</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">dt</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We are going to extend the Flame <code class="docutils literal notranslate"><span class="pre">SpriteComponent</span></code> and we will need the <code class="docutils literal notranslate"><span class="pre">HasGameRef</span></code> mixin to access
our game class just like we did before. We are starting with the empty <code class="docutils literal notranslate"><span class="pre">onLoad</span></code> and <code class="docutils literal notranslate"><span class="pre">update</span></code>
methods and we will begin adding code to create the functionality that is necessary for the game.</p>
<p>The secret to any gaming engine is the game loop. This is an infinite loop that calls all the
objects in your game so you can provide updates. The <code class="docutils literal notranslate"><span class="pre">update</span></code> method is the hook into this and it
uses a <code class="docutils literal notranslate"><span class="pre">double</span> <span class="pre">dt</span></code> to pass to your method the amount of time in seconds since it was last
called. This <code class="docutils literal notranslate"><span class="pre">dt</span></code> variable then allows you to calculate how far your component needs to move
on-screen.</p>
<p>All components in our game will need to move at the same speed, so to do this, open
<code class="docutils literal notranslate"><span class="pre">lib/ember_quest.dart</span></code>, and let’s define a global variable called <code class="docutils literal notranslate"><span class="pre">objectSpeed</span></code>. At the top of the
<code class="docutils literal notranslate"><span class="pre">EmberQuestGame</span></code> class, add:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="kd">late</span><span class="w"> </span><span class="n">EmberPlayer</span><span class="w"> </span><span class="n">_ember</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">objectSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.0</span><span class="p">;</span>
</pre></div>
</div>
<p>So to implement that movement, declare a variable at the top of the <code class="docutils literal notranslate"><span class="pre">PlatformBlock</span></code> class and make
your <code class="docutils literal notranslate"><span class="pre">update</span></code> method look like this:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">final</span><span class="w"> </span><span class="n">Vector2</span><span class="w"> </span><span class="n">velocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector2</span><span class="p">.</span><span class="n">zero</span><span class="p">();</span>
</pre></div>
</div>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">velocity</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">objectSpeed</span><span class="p">;</span>
<span class="w">    </span><span class="n">position</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">velocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dt</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="n">size</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">removeFromParent</span><span class="p">();</span>
<span class="w">    </span><span class="k">super</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">dt</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
<p>All that is happening is we define a base <code class="docutils literal notranslate"><span class="pre">velocity</span></code> that is instantiated at 0 on both axes and then
we update <code class="docutils literal notranslate"><span class="pre">velocity</span></code> using the global <code class="docutils literal notranslate"><span class="pre">objectSpeed</span></code> variable for the x-axis. As this is our
platform block, it will only scroll left and right, so our y-axis in the <code class="docutils literal notranslate"><span class="pre">velocity</span></code> will always be 0
as do not want our blocks jumping.</p>
<p>Next, we update the <code class="docutils literal notranslate"><span class="pre">position</span></code> which is a special variable built into the Flame engine components.
By multiplying the <code class="docutils literal notranslate"><span class="pre">velocity</span></code> vector by the <code class="docutils literal notranslate"><span class="pre">dt</span></code> we can move our component to the required amount.</p>
<p>Finally, if <code class="docutils literal notranslate"><span class="pre">x</span></code> value of position is <code class="docutils literal notranslate"><span class="pre">-size.x</span></code> (this means off the left side of the screen by the
width of the image) then remove this platform block from the game entirely.</p>
<p>Now we just need to finish the <code class="docutils literal notranslate"><span class="pre">onLoad</span></code> method. So make your <code class="docutils literal notranslate"><span class="pre">onLoad</span></code> method look like this:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">onLoad</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">platformImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">images</span><span class="p">.</span><span class="n">fromCache</span><span class="p">(</span><span class="s1">&#39;block.png&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="n">sprite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sprite</span><span class="p">(</span><span class="n">platformImage</span><span class="p">);</span>
<span class="w">    </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector2</span><span class="p">((</span><span class="n">gridPosition</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">game</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">gridPosition</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">.</span><span class="n">y</span><span class="p">),</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">add</span><span class="p">(</span><span class="n">RectangleHitbox</span><span class="p">(</span><span class="nl">collisionType:</span><span class="w"> </span><span class="n">CollisionType</span><span class="p">.</span><span class="n">passive</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
<p>First, we retrieve the image from cache as we did before, and because this is a <code class="docutils literal notranslate"><span class="pre">SpriteComponent</span></code>
we can use the built-in <code class="docutils literal notranslate"><span class="pre">sprite</span></code> variable to assign the image to the component. Next, we need to
calculate its starting position. This is where all the magic happens, so let’s break this down.</p>
<p>Just like in the <code class="docutils literal notranslate"><span class="pre">update</span></code> method we will be setting the <code class="docutils literal notranslate"><span class="pre">position</span></code> variable to a <code class="docutils literal notranslate"><span class="pre">Vector2</span></code>. To
determine where it needs to be, we need to calculate the x and y positions. Focusing on the x
first, we can see that we are taking <code class="docutils literal notranslate"><span class="pre">gridPosition.x</span></code> times the width of the image and then we will
add that to the <code class="docutils literal notranslate"><span class="pre">xOffset</span></code> that we pass in. With the y-axis, we will take the height of the
game and we will subtract the <code class="docutils literal notranslate"><span class="pre">gridPosition.y</span></code> times the height of the image.</p>
<p>Lastly, as we want Ember to be able to interact with the platform, we will add a <code class="docutils literal notranslate"><span class="pre">RectangleHitbox</span></code>
with a <code class="docutils literal notranslate"><span class="pre">passive</span></code> <code class="docutils literal notranslate"><span class="pre">CollisionType</span></code>. Collisions will be explained more in a later chapter.</p>
<section id="display-the-platform">
<h4>Display the Platform<a class="headerlink" href="#display-the-platform" title="Link to this heading">¶</a></h4>
<p>In our <code class="docutils literal notranslate"><span class="pre">loadGameSegments</span></code> method from earlier, we will need to add the call to add our block. We
will need to define <code class="docutils literal notranslate"><span class="pre">gridPosition</span></code> and <code class="docutils literal notranslate"><span class="pre">xOffset</span></code> to be passed in. <code class="docutils literal notranslate"><span class="pre">gridPosition</span></code> will be a
<code class="docutils literal notranslate"><span class="pre">Vector2</span></code> and <code class="docutils literal notranslate"><span class="pre">xOffset</span></code> is a double as that will be used to calculate the x-axis offset for
the block in a <code class="docutils literal notranslate"><span class="pre">Vector2</span></code>. So add the following to your <code class="docutils literal notranslate"><span class="pre">loadGameSegments</span></code> method:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="k">case</span><span class="w"> </span><span class="nl">PlatformBlock:</span>
<span class="w">  </span><span class="n">add</span><span class="p">(</span><span class="n">PlatformBlock</span><span class="p">(</span>
<span class="w">    </span><span class="nl">gridPosition:</span><span class="w"> </span><span class="n">block</span><span class="p">.</span><span class="n">gridPosition</span><span class="p">,</span>
<span class="w">    </span><span class="nl">xOffset:</span><span class="w"> </span><span class="n">xPositionOffset</span><span class="p">,</span>
<span class="w">  </span><span class="p">));</span>
</pre></div>
</div>
<p>If you run your code, you should now see:</p>
<p><img alt="Platforms Displayed" src="../../_images/Step3Platforms.jpg" /></p>
<p>While this does run, the black just makes it look like Ember is in a dungeon. Let’s change that
background real quick so there is a nice blue sky. Just add the following code to
<code class="docutils literal notranslate"><span class="pre">lib/ember_quest.dart</span></code>:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:flutter/material.dart&#39;</span><span class="p">;</span>

<span class="nd">@override</span>
<span class="n">Color</span><span class="w"> </span><span class="n">backgroundColor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="n">fromARGB</span><span class="p">(</span><span class="m">255</span><span class="p">,</span><span class="w"> </span><span class="m">173</span><span class="p">,</span><span class="w"> </span><span class="m">223</span><span class="p">,</span><span class="w"> </span><span class="m">247</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Excellent! Ember is now in front of a blue sky.</p>
<p>On to <a class="reference internal" href="step_4.html"><span class="std std-doc">4. Adding the Remaining Components</span></a>, where we will add the rest of the components now that we have a basic
understanding of what we are going to accomplish.</p>
</section>
</section>
</section>
</section>


    </div>
    <div class="copyright">
      The content on this page is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0 License</a>,
      and code samples under the <a href="https://raw.githubusercontent.com/flame-engine/flame/main/LICENSE">MIT License</a>.
    </div>
    <div class="prev-next-area">
      <a class="left-prev" id="prev-link" href="step_2.html" title="previous page">
        <i class="fa fa-angle-left"></i>
        <div class="prev-next-info">
          <p class="prev-next-subtitle">Previous:</p>
          <p class="prev-next-title">2. Start Coding</p>
        </div>
      </a>
      <div class='expander'></div>
      <a class="right-next" id="next-link" href="step_4.html" title="next page">
        <div class="prev-next-info">
          <p class="prev-next-subtitle">Next:</p>
          <p class="prev-next-title">4. Adding the Remaining Components</p>
        </div>
        <i class="fa fa-angle-right"></i>
      </a>
    </div>
  </div>

  <div class="sidebar-right">
    
    <div class="nav-right" role="navigation" aria-label="table of contents">
      <div id='toc-local' class='list-group'>
 <div class='header'><i class='fa fa-list'></i> Contents</div>
  <a href='#creating-segments' class='list-group-item level-1'>Creating Segments</a>
  <a href='#segment-manager' class='list-group-item level-2'>Segment Manager</a>
  <a href='#loading-the-segments-into-the-world' class='list-group-item level-2'>Loading the Segments into the World</a>
  <a href='#the-platform-block' class='list-group-item level-2'>The Platform Block</a>
  <a href='#display-the-platform' class='list-group-item level-3'>Display the Platform</a>
</div>

    </div>
  </div>

  <div class="expander"></div>
</div>




</body>
</html>