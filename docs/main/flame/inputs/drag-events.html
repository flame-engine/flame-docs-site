<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Drag events &#8212; Flame</title>
  <!-- Stylesheets -->
  <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/basic.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/flutter_app.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/flames.css" />
  <!-- Scripts -->
  <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
  <script src="../../_static/jquery.js"></script>
  <script src="../../_static/underscore.js"></script>
  <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
  <script src="../../_static/doctools.js"></script>
  <script src="../../_static/flutter_app.js"></script>
  <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({startOnLoad:true});</script>
  <script src="../../_static/versions.js"></script>
  <!--script src="searchindex.js" defer></script-->
  <!-- Links -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,400;0,700;1,400;1,700&display=swap">
  <link rel="preload" as="font" type="font/woff2" crossorigin="" href="../../_static/fontawesome/fa-brands-400.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin="" href="../../_static/fontawesome/fa-solid-900.woff2">
  <link rel="stylesheet" href="../../_static/fontawesome/all.min.css">
  <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="next" title="Gesture Input" href="gesture-input.html" />
  <link rel="prev" title="Tap events" href="tap-events.html" />
</head>

<body data-spy="scroll" data-target="#toc-local" data-offset="80">

<div class="top-bar">
  <button id="menu-button" class="btn" title="Toggle menu"><i class="fa fa-bars"></i></button>
  <script type="text/javascript">
    jQuery(function(){
      $("#menu-button").click(function() {
        $(this).toggleClass("active");
        $(".sidebar-left-area").toggleClass("active");
      });
    });
  </script>

  <a href="../../index.html" class="logo_image">
    <img src="../../_static/logo_flame.png">
  </a>

  <div class="highlight-box" role="alert" style="display:none">
    <div>
      <div class="title">highlighted:</div>
      <div class="content" id="highlight-content"></div>
    </div>
    <button type="button" class="close" data-dismiss="alert" aria-label="Dismiss">×</button>
  </div>
  <div class="expander"></div>

  <div class="versions-placeholder"></div>
  <a href="https://discord.com/channels/509714518008528896/516639688581316629" id="discord-button"
     class="btn" title="Flame Discord channel">
    <i class="fab fa-discord"></i>
  </a>
  <a href="https://github.com/flame-engine/flame/" id="github-button" class="btn"
     title="GitHub repository">
    <i class="fab fa-github"></i>
  </a>
</div>

<div class="sidebar-left-area">
  <div class="sidebar-left-bg"></div>
  <div class="sidebar-left">
    <div class="searchbox" role="search">
      <form id="search-form" action="../../search.html" method="get">
        <i class="icon fa fa-search"></i>
        <input type="search" class="form-control" id="search-input" name="q"
               placeholder="Search the docs..." autocomplete="off" />
      </form>
    </div>
    <div class="nav-left" role="navigation" aria-label="Main">
      <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../flame.html">flame</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../structure.html">File structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../game_widget.html">GameWidget</a></li>
<li class="toctree-l2"><a class="reference internal" href="../game.html">Game loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components.html">Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../platforms.html">Platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../collision_detection.html">Collision detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../effects.html">Effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../camera_and_viewport.html">Camera &amp; Viewport</a></li>
<li class="toctree-l2"><a class="reference internal" href="../camera_component.html">Camera component</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="inputs.html">Inputs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tap-events.html">Tap events</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Drag events</a></li>
<li class="toctree-l3"><a class="reference internal" href="gesture-input.html">Gesture input</a></li>
<li class="toctree-l3"><a class="reference internal" href="keyboard-input.html">Keyboard input</a></li>
<li class="toctree-l3"><a class="reference internal" href="other-inputs.html">Other inputs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../rendering/rendering.html">Rendering</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../rendering/images.html">Images, sprites and animations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rendering/text.html">Text rendering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rendering/palette.html">Colors and palette</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rendering/particles.html">Particles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rendering/layers.html">Layers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../other/other.html">Other</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../other/debug.html">Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../other/util.html">Utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="../other/widgets.html">Widgets</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../flame_audio/flame_audio.html">flame_audio</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../flame_audio/audio.html">General audio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame_audio/bgm.html">Background music</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame_audio/audio_pool.html">AudioPool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../flame_forge2d/flame_forge2d.html">flame_forge2d</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../flame_forge2d/forge2d.html">Overview</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/bare_flame_game.html">Bare Flame game</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/klondike/klondike.html">Klondike</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/klondike/step1.html">1. Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/klondike/step2.html">2. Scaffolding</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/klondike/step3.html">3. Cards</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/klondike/step4.html">4. Gameplay</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/klondike/tbc.html">[To be continued]...</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../other_modules/other_modules.html">Other Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../other_modules/oxygen.html">Oxygen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_modules/tiled.html">Tiled</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_modules/splash_screen.html">Splash screen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development/development.html">Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/documentation.html">Documentation</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
</div>

<div class="main-area">
  <div class="document-wrapper">
    <div class="document" role="main">
      
  <section class="tex2jax_ignore mathjax_ignore" id="drag-events">
<h1>Drag events<a class="headerlink" href="#drag-events" title="Permalink to this heading">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This document describes a new experimental API. The more traditional approach
for handling drag events is described in <a class="reference internal" href="gesture-input.html"><span class="doc std std-doc">Gesture Input</span></a>.</p>
</div>
<p><strong>Drag events</strong> occur when the user moves their finger across the screen of the device, or when they
move the mouse while holding its button down.</p>
<p>Multiple drag events can occur at the same time, if the user is using multiple fingers. Such cases
will be handled correctly by Flame, and you can even keep track of the events by using their
<code class="docutils literal notranslate"><span class="pre">pointerId</span></code> property.</p>
<p>In order to enable drag events for your game, do the following:</p>
<ol>
<li><p>Add the <code class="docutils literal notranslate"><span class="pre">HasDraggableComponents</span></code> mixin to your main game class:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">MyGame</span> <span class="kd">extends</span> <span class="n">FlameGame</span> <span class="kd">with</span> <span class="n">HasDraggableComponents</span> <span class="p">{</span>
 <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>For those components that you want to respond to drags, add the <code class="docutils literal notranslate"><span class="pre">DragCallbacks</span></code> mixin.</p>
<ul class="simple">
<li><p>This mixin adds four overridable methods to your component: <code class="docutils literal notranslate"><span class="pre">onDragStart</span></code>, <code class="docutils literal notranslate"><span class="pre">onDragUpdate</span></code>,
<code class="docutils literal notranslate"><span class="pre">onDragEnd</span></code>, and <code class="docutils literal notranslate"><span class="pre">onDragCancel</span></code>. By default, these methods do nothing – they need to be
overridden in order to perform any function.</p></li>
<li><p>In addition, the component must implement the <code class="docutils literal notranslate"><span class="pre">containsLocalPoint()</span></code> method – this method
allows Flame to know whether the event occurred within the component or not.</p></li>
</ul>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">MyComponent</span> <span class="kd">extends</span> <span class="n">PositionComponent</span> <span class="kd">with</span> <span class="n">DragCallbacks</span> <span class="p">{</span>
  <span class="n">MyComponent</span><span class="p">()</span> <span class="o">:</span> <span class="k">super</span><span class="p">(</span><span class="nl">size:</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">180</span><span class="p">,</span> <span class="m">120</span><span class="p">));</span>

  <span class="nd">@override</span>
  <span class="kt">void</span> <span class="n">onDragStart</span><span class="p">(</span><span class="n">DragStartEvent</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Do something in response to a drag event</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
<section id="demo">
<h2>Demo<a class="headerlink" href="#demo" title="Permalink to this heading">¶</a></h2>
<p>In this example you can use drag gestures to either drag star-like shapes across the screen, or to
draw curves inside the pink rectangle.</p>
<iframe class="flutter-app-iframe" src="/main/_static/apps/flame-examples/index.html?drag_events">
</iframe><div class="flutter-app-code docutils container" id="flame-examples-source">
<div class="filename docutils container">
drag_events.dart</div>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="k">import</span> <span class="s1">&#39;dart:math&#39;</span><span class="p">;</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="k">import</span> <span class="s1">&#39;package:flame/components.dart&#39;</span><span class="p">;</span>
<span class="linenos">  4</span><span class="k">import</span> <span class="s1">&#39;package:flame/experimental.dart&#39;</span><span class="p">;</span>
<span class="linenos">  5</span><span class="k">import</span> <span class="s1">&#39;package:flame/game.dart&#39;</span><span class="p">;</span>
<span class="linenos">  6</span><span class="k">import</span> <span class="s1">&#39;package:flutter/rendering.dart&#39;</span><span class="p">;</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="c1">/// The main [FlameGame] class uses [HasDraggableComponents] in order to enable</span>
<span class="linenos">  9</span><span class="c1">/// tap events propagation.</span>
<span class="linenos"> 10</span><span class="kd">class</span> <span class="nc">DragEventsGame</span> <span class="kd">extends</span> <span class="n">FlameGame</span> <span class="kd">with</span> <span class="n">HasDraggableComponents</span> <span class="p">{</span>
<span class="linenos"> 11</span>  <span class="nd">@override</span>
<span class="linenos"> 12</span>  <span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span> <span class="n">onLoad</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
<span class="linenos"> 13</span>    <span class="n">addAll</span><span class="p">([</span>
<span class="linenos"> 14</span>      <span class="n">DragTarget</span><span class="p">(),</span>
<span class="linenos"> 15</span>      <span class="n">Star</span><span class="p">(</span>
<span class="linenos"> 16</span>        <span class="nl">n:</span> <span class="m">5</span><span class="p">,</span>
<span class="linenos"> 17</span>        <span class="nl">radius1:</span> <span class="m">40</span><span class="p">,</span>
<span class="linenos"> 18</span>        <span class="nl">radius2:</span> <span class="m">20</span><span class="p">,</span>
<span class="linenos"> 19</span>        <span class="nl">sharpness:</span> <span class="m">0.2</span><span class="p">,</span>
<span class="linenos"> 20</span>        <span class="nl">color:</span> <span class="k">const</span> <span class="n">Color</span><span class="p">(</span><span class="mh">0xffbae5ad</span><span class="p">),</span>
<span class="linenos"> 21</span>        <span class="nl">position:</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">70</span><span class="p">,</span> <span class="m">70</span><span class="p">),</span>
<span class="linenos"> 22</span>      <span class="p">),</span>
<span class="linenos"> 23</span>      <span class="n">Star</span><span class="p">(</span>
<span class="linenos"> 24</span>        <span class="nl">n:</span> <span class="m">3</span><span class="p">,</span>
<span class="linenos"> 25</span>        <span class="nl">radius1:</span> <span class="m">50</span><span class="p">,</span>
<span class="linenos"> 26</span>        <span class="nl">radius2:</span> <span class="m">40</span><span class="p">,</span>
<span class="linenos"> 27</span>        <span class="nl">sharpness:</span> <span class="m">0.3</span><span class="p">,</span>
<span class="linenos"> 28</span>        <span class="nl">color:</span> <span class="k">const</span> <span class="n">Color</span><span class="p">(</span><span class="mh">0xff6ecbe5</span><span class="p">),</span>
<span class="linenos"> 29</span>        <span class="nl">position:</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">70</span><span class="p">,</span> <span class="m">160</span><span class="p">),</span>
<span class="linenos"> 30</span>      <span class="p">),</span>
<span class="linenos"> 31</span>      <span class="n">Star</span><span class="p">(</span>
<span class="linenos"> 32</span>        <span class="nl">n:</span> <span class="m">12</span><span class="p">,</span>
<span class="linenos"> 33</span>        <span class="nl">radius1:</span> <span class="m">10</span><span class="p">,</span>
<span class="linenos"> 34</span>        <span class="nl">radius2:</span> <span class="m">75</span><span class="p">,</span>
<span class="linenos"> 35</span>        <span class="nl">sharpness:</span> <span class="m">1.3</span><span class="p">,</span>
<span class="linenos"> 36</span>        <span class="nl">color:</span> <span class="k">const</span> <span class="n">Color</span><span class="p">(</span><span class="mh">0xfff6df6a</span><span class="p">),</span>
<span class="linenos"> 37</span>        <span class="nl">position:</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">70</span><span class="p">,</span> <span class="m">270</span><span class="p">),</span>
<span class="linenos"> 38</span>      <span class="p">),</span>
<span class="linenos"> 39</span>      <span class="n">Star</span><span class="p">(</span>
<span class="linenos"> 40</span>        <span class="nl">n:</span> <span class="m">10</span><span class="p">,</span>
<span class="linenos"> 41</span>        <span class="nl">radius1:</span> <span class="m">20</span><span class="p">,</span>
<span class="linenos"> 42</span>        <span class="nl">radius2:</span> <span class="m">17</span><span class="p">,</span>
<span class="linenos"> 43</span>        <span class="nl">sharpness:</span> <span class="m">0.85</span><span class="p">,</span>
<span class="linenos"> 44</span>        <span class="nl">color:</span> <span class="k">const</span> <span class="n">Color</span><span class="p">(</span><span class="mh">0xfff82a4b</span><span class="p">),</span>
<span class="linenos"> 45</span>        <span class="nl">position:</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">110</span><span class="p">,</span> <span class="m">110</span><span class="p">),</span>
<span class="linenos"> 46</span>      <span class="p">),</span>
<span class="linenos"> 47</span>    <span class="p">]);</span>
<span class="linenos"> 48</span>  <span class="p">}</span>
<span class="linenos"> 49</span><span class="p">}</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span><span class="c1">/// This component is the pink-ish rectangle in the center of the game window.</span>
<span class="linenos"> 52</span><span class="c1">/// It uses the [DragCallbacks] mixin in order to inform the game that it wants</span>
<span class="linenos"> 53</span><span class="c1">/// to receive drag events.</span>
<span class="linenos"> 54</span><span class="kd">class</span> <span class="nc">DragTarget</span> <span class="kd">extends</span> <span class="n">PositionComponent</span> <span class="kd">with</span> <span class="n">DragCallbacks</span> <span class="p">{</span>
<span class="linenos"> 55</span>  <span class="n">DragTarget</span><span class="p">()</span> <span class="o">:</span> <span class="k">super</span><span class="p">(</span><span class="nl">anchor:</span> <span class="n">Anchor</span><span class="p">.</span><span class="n">center</span><span class="p">);</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span>  <span class="kd">final</span> <span class="n">_rectPaint</span> <span class="o">=</span> <span class="n">Paint</span><span class="p">()..</span><span class="n">color</span> <span class="o">=</span> <span class="k">const</span> <span class="n">Color</span><span class="p">(</span><span class="mh">0x88AC54BF</span><span class="p">);</span>
<span class="linenos"> 58</span>
<span class="linenos"> 59</span>  <span class="c1">/// We will store all current circles into this map, keyed by the `pointerId`</span>
<span class="linenos"> 60</span>  <span class="c1">/// of the event that created the circle.</span>
<span class="linenos"> 61</span>  <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">Trail</span><span class="o">&gt;</span> <span class="n">_trails</span> <span class="o">=</span> <span class="p">{};</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>  <span class="nd">@override</span>
<span class="linenos"> 64</span>  <span class="kt">void</span> <span class="n">onGameResize</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">canvasSize</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos"> 65</span>    <span class="k">super</span><span class="p">.</span><span class="n">onGameResize</span><span class="p">(</span><span class="n">canvasSize</span><span class="p">);</span>
<span class="linenos"> 66</span>    <span class="n">size</span> <span class="o">=</span> <span class="n">canvasSize</span> <span class="o">-</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">75</span><span class="p">);</span>
<span class="linenos"> 67</span>    <span class="k">if</span> <span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="m">100</span> <span class="o">||</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="m">100</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos"> 68</span>      <span class="n">size</span> <span class="o">=</span> <span class="n">canvasSize</span> <span class="o">*</span> <span class="m">0.9</span><span class="p">;</span>
<span class="linenos"> 69</span>    <span class="p">}</span>
<span class="linenos"> 70</span>    <span class="n">position</span> <span class="o">=</span> <span class="n">canvasSize</span> <span class="o">/</span> <span class="m">2</span><span class="p">;</span>
<span class="linenos"> 71</span>  <span class="p">}</span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span>  <span class="nd">@override</span>
<span class="linenos"> 74</span>  <span class="kt">void</span> <span class="n">render</span><span class="p">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos"> 75</span>    <span class="n">canvas</span><span class="p">.</span><span class="n">drawRect</span><span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">toRect</span><span class="p">(),</span> <span class="n">_rectPaint</span><span class="p">);</span>
<span class="linenos"> 76</span>  <span class="p">}</span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span>  <span class="nd">@override</span>
<span class="linenos"> 79</span>  <span class="kt">void</span> <span class="n">onDragStart</span><span class="p">(</span><span class="n">DragStartEvent</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos"> 80</span>    <span class="kd">final</span> <span class="n">trail</span> <span class="o">=</span> <span class="n">Trail</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">localPosition</span><span class="p">);</span>
<span class="linenos"> 81</span>    <span class="n">_trails</span><span class="p">[</span><span class="n">event</span><span class="p">.</span><span class="n">pointerId</span><span class="p">]</span> <span class="o">=</span> <span class="n">trail</span><span class="p">;</span>
<span class="linenos"> 82</span>    <span class="n">add</span><span class="p">(</span><span class="n">trail</span><span class="p">);</span>
<span class="linenos"> 83</span>  <span class="p">}</span>
<span class="linenos"> 84</span>
<span class="linenos"> 85</span>  <span class="nd">@override</span>
<span class="linenos"> 86</span>  <span class="kt">void</span> <span class="n">onDragUpdate</span><span class="p">(</span><span class="n">DragUpdateEvent</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos"> 87</span>    <span class="n">_trails</span><span class="p">[</span><span class="n">event</span><span class="p">.</span><span class="n">pointerId</span><span class="p">]</span><span class="o">!</span><span class="p">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">localPosition</span><span class="p">);</span>
<span class="linenos"> 88</span>  <span class="p">}</span>
<span class="linenos"> 89</span>
<span class="linenos"> 90</span>  <span class="nd">@override</span>
<span class="linenos"> 91</span>  <span class="kt">void</span> <span class="n">onDragEnd</span><span class="p">(</span><span class="n">DragEndEvent</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos"> 92</span>    <span class="n">_trails</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">pointerId</span><span class="p">)</span><span class="o">!</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
<span class="linenos"> 93</span>  <span class="p">}</span>
<span class="linenos"> 94</span>
<span class="linenos"> 95</span>  <span class="nd">@override</span>
<span class="linenos"> 96</span>  <span class="kt">void</span> <span class="n">onDragCancel</span><span class="p">(</span><span class="n">DragCancelEvent</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos"> 97</span>    <span class="n">_trails</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">pointerId</span><span class="p">)</span><span class="o">!</span><span class="p">.</span><span class="n">cancel</span><span class="p">();</span>
<span class="linenos"> 98</span>  <span class="p">}</span>
<span class="linenos"> 99</span><span class="p">}</span>
<span class="linenos">100</span>
<span class="linenos">101</span><span class="kd">class</span> <span class="nc">Trail</span> <span class="kd">extends</span> <span class="n">Component</span> <span class="p">{</span>
<span class="linenos">102</span>  <span class="n">Trail</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">origin</span><span class="p">)</span>
<span class="linenos">103</span>      <span class="o">:</span> <span class="n">_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="p">()..</span><span class="n">moveTo</span><span class="p">(</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">origin</span><span class="p">.</span><span class="n">y</span><span class="p">)],</span>
<span class="linenos">104</span>        <span class="n">_opacities</span> <span class="o">=</span> <span class="p">[</span><span class="m">1</span><span class="p">],</span>
<span class="linenos">105</span>        <span class="n">_lastPoint</span> <span class="o">=</span> <span class="n">origin</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span>
<span class="linenos">106</span>        <span class="n">_color</span> <span class="o">=</span>
<span class="linenos">107</span>            <span class="n">HSLColor</span><span class="p">.</span><span class="n">fromAHSL</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">random</span><span class="p">.</span><span class="n">nextDouble</span><span class="p">()</span> <span class="o">*</span> <span class="m">360</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0.8</span><span class="p">).</span><span class="n">toColor</span><span class="p">();</span>
<span class="linenos">108</span>
<span class="linenos">109</span>  <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Path</span><span class="o">&gt;</span> <span class="n">_paths</span><span class="p">;</span>
<span class="linenos">110</span>  <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">_opacities</span><span class="p">;</span>
<span class="linenos">111</span>  <span class="n">Color</span> <span class="n">_color</span><span class="p">;</span>
<span class="linenos">112</span>  <span class="kd">late</span> <span class="kd">final</span> <span class="n">_linePaint</span> <span class="o">=</span> <span class="n">Paint</span><span class="p">()..</span><span class="n">style</span> <span class="o">=</span> <span class="n">PaintingStyle</span><span class="p">.</span><span class="n">stroke</span><span class="p">;</span>
<span class="linenos">113</span>  <span class="kd">late</span> <span class="kd">final</span> <span class="n">_circlePaint</span> <span class="o">=</span> <span class="n">Paint</span><span class="p">()..</span><span class="n">color</span> <span class="o">=</span> <span class="n">_color</span><span class="p">;</span>
<span class="linenos">114</span>  <span class="kt">bool</span> <span class="n">_released</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="linenos">115</span>  <span class="kt">double</span> <span class="n">_timer</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
<span class="linenos">116</span>  <span class="kd">final</span> <span class="n">_vanishInterval</span> <span class="o">=</span> <span class="m">0.03</span><span class="p">;</span>
<span class="linenos">117</span>  <span class="kd">final</span> <span class="n">Vector2</span> <span class="n">_lastPoint</span><span class="p">;</span>
<span class="linenos">118</span>
<span class="linenos">119</span>  <span class="kd">static</span> <span class="kd">final</span> <span class="n">random</span> <span class="o">=</span> <span class="n">Random</span><span class="p">();</span>
<span class="linenos">120</span>  <span class="kd">static</span> <span class="k">const</span> <span class="n">lineWidth</span> <span class="o">=</span> <span class="m">10.0</span><span class="p">;</span>
<span class="linenos">121</span>
<span class="linenos">122</span>  <span class="nd">@override</span>
<span class="linenos">123</span>  <span class="kt">void</span> <span class="n">render</span><span class="p">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">124</span>    <span class="k">assert</span><span class="p">(</span><span class="n">_paths</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="n">_opacities</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
<span class="linenos">125</span>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="n">i</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">_paths</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">126</span>      <span class="kd">final</span> <span class="n">path</span> <span class="o">=</span> <span class="n">_paths</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="linenos">127</span>      <span class="kd">final</span> <span class="n">opacity</span> <span class="o">=</span> <span class="n">_opacities</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="linenos">128</span>      <span class="k">if</span> <span class="p">(</span><span class="n">opacity</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">129</span>        <span class="n">_linePaint</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">_color</span><span class="p">.</span><span class="n">withOpacity</span><span class="p">(</span><span class="n">opacity</span><span class="p">);</span>
<span class="linenos">130</span>        <span class="n">_linePaint</span><span class="p">.</span><span class="n">strokeWidth</span> <span class="o">=</span> <span class="n">lineWidth</span> <span class="o">*</span> <span class="n">opacity</span><span class="p">;</span>
<span class="linenos">131</span>        <span class="n">canvas</span><span class="p">.</span><span class="n">drawPath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">_linePaint</span><span class="p">);</span>
<span class="linenos">132</span>      <span class="p">}</span>
<span class="linenos">133</span>    <span class="p">}</span>
<span class="linenos">134</span>    <span class="n">canvas</span><span class="p">.</span><span class="n">drawCircle</span><span class="p">(</span>
<span class="linenos">135</span>      <span class="n">_lastPoint</span><span class="p">.</span><span class="n">toOffset</span><span class="p">(),</span>
<span class="linenos">136</span>      <span class="p">(</span><span class="n">lineWidth</span> <span class="o">-</span> <span class="m">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">_opacities</span><span class="p">.</span><span class="n">last</span> <span class="o">+</span> <span class="m">2</span><span class="p">,</span>
<span class="linenos">137</span>      <span class="n">_circlePaint</span><span class="p">,</span>
<span class="linenos">138</span>    <span class="p">);</span>
<span class="linenos">139</span>  <span class="p">}</span>
<span class="linenos">140</span>
<span class="linenos">141</span>  <span class="nd">@override</span>
<span class="linenos">142</span>  <span class="kt">void</span> <span class="n">update</span><span class="p">(</span><span class="kt">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">143</span>    <span class="k">assert</span><span class="p">(</span><span class="n">_paths</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="n">_opacities</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
<span class="linenos">144</span>    <span class="n">_timer</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
<span class="linenos">145</span>    <span class="k">while</span> <span class="p">(</span><span class="n">_timer</span> <span class="o">&gt;</span> <span class="n">_vanishInterval</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">146</span>      <span class="n">_timer</span> <span class="o">-=</span> <span class="n">_vanishInterval</span><span class="p">;</span>
<span class="linenos">147</span>      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="n">i</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">_paths</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">148</span>        <span class="n">_opacities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="m">0.01</span><span class="p">;</span>
<span class="linenos">149</span>        <span class="k">if</span> <span class="p">(</span><span class="n">_opacities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">150</span>          <span class="n">_paths</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">reset</span><span class="p">();</span>
<span class="linenos">151</span>        <span class="p">}</span>
<span class="linenos">152</span>      <span class="p">}</span>
<span class="linenos">153</span>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_released</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">154</span>        <span class="n">_paths</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Path</span><span class="p">()..</span><span class="n">moveTo</span><span class="p">(</span><span class="n">_lastPoint</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">_lastPoint</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
<span class="linenos">155</span>        <span class="n">_opacities</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
<span class="linenos">156</span>      <span class="p">}</span>
<span class="linenos">157</span>    <span class="p">}</span>
<span class="linenos">158</span>    <span class="k">if</span> <span class="p">(</span><span class="n">_opacities</span><span class="p">.</span><span class="n">last</span> <span class="o">&lt;</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">159</span>      <span class="n">removeFromParent</span><span class="p">();</span>
<span class="linenos">160</span>    <span class="p">}</span>
<span class="linenos">161</span>  <span class="p">}</span>
<span class="linenos">162</span>
<span class="linenos">163</span>  <span class="kt">void</span> <span class="n">addPoint</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">point</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">164</span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="p">.</span><span class="n">isNaN</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">165</span>      <span class="k">for</span> <span class="p">(</span><span class="kd">final</span> <span class="n">path</span> <span class="k">in</span> <span class="n">_paths</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">166</span>        <span class="n">path</span><span class="p">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="linenos">167</span>      <span class="p">}</span>
<span class="linenos">168</span>      <span class="n">_lastPoint</span><span class="p">.</span><span class="n">setFrom</span><span class="p">(</span><span class="n">point</span><span class="p">);</span>
<span class="linenos">169</span>    <span class="p">}</span>
<span class="linenos">170</span>  <span class="p">}</span>
<span class="linenos">171</span>
<span class="linenos">172</span>  <span class="kt">void</span> <span class="n">end</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="n">_released</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="linenos">173</span>
<span class="linenos">174</span>  <span class="kt">void</span> <span class="n">cancel</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos">175</span>    <span class="n">_released</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="linenos">176</span>    <span class="n">_color</span> <span class="o">=</span> <span class="k">const</span> <span class="n">Color</span><span class="p">(</span><span class="mh">0xFFFFFFFF</span><span class="p">);</span>
<span class="linenos">177</span>  <span class="p">}</span>
<span class="linenos">178</span><span class="p">}</span>
<span class="linenos">179</span>
<span class="linenos">180</span><span class="kd">class</span> <span class="nc">Star</span> <span class="kd">extends</span> <span class="n">PositionComponent</span> <span class="kd">with</span> <span class="n">DragCallbacks</span> <span class="p">{</span>
<span class="linenos">181</span>  <span class="n">Star</span><span class="p">({</span>
<span class="linenos">182</span>    <span class="kd">required</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span>
<span class="linenos">183</span>    <span class="kd">required</span> <span class="kt">double</span> <span class="n">radius1</span><span class="p">,</span>
<span class="linenos">184</span>    <span class="kd">required</span> <span class="kt">double</span> <span class="n">radius2</span><span class="p">,</span>
<span class="linenos">185</span>    <span class="kd">required</span> <span class="kt">double</span> <span class="n">sharpness</span><span class="p">,</span>
<span class="linenos">186</span>    <span class="kd">required</span> <span class="k">this</span><span class="p">.</span><span class="n">color</span><span class="p">,</span>
<span class="linenos">187</span>    <span class="k">super</span><span class="p">.</span><span class="n">position</span><span class="p">,</span>
<span class="linenos">188</span>  <span class="p">})</span> <span class="p">{</span>
<span class="linenos">189</span>    <span class="n">_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">()..</span><span class="n">moveTo</span><span class="p">(</span><span class="n">radius1</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
<span class="linenos">190</span>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="n">i</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">191</span>      <span class="kd">final</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">radius2</span><span class="p">,</span> <span class="m">0</span><span class="p">)..</span><span class="n">rotate</span><span class="p">(</span><span class="n">tau</span> <span class="o">/</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">sharpness</span><span class="p">));</span>
<span class="linenos">192</span>      <span class="kd">final</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">radius2</span><span class="p">,</span> <span class="m">0</span><span class="p">)..</span><span class="n">rotate</span><span class="p">(</span><span class="n">tau</span> <span class="o">/</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="m">1</span> <span class="o">-</span> <span class="n">sharpness</span><span class="p">));</span>
<span class="linenos">193</span>      <span class="kd">final</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">radius1</span><span class="p">,</span> <span class="m">0</span><span class="p">)..</span><span class="n">rotate</span><span class="p">(</span><span class="n">tau</span> <span class="o">/</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="m">1</span><span class="p">));</span>
<span class="linenos">194</span>      <span class="n">_path</span><span class="p">.</span><span class="n">cubicTo</span><span class="p">(</span><span class="n">p1</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p1</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p2</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p2</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p3</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p3</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="linenos">195</span>    <span class="p">}</span>
<span class="linenos">196</span>    <span class="n">_path</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="linenos">197</span>  <span class="p">}</span>
<span class="linenos">198</span>
<span class="linenos">199</span>  <span class="kd">final</span> <span class="n">Color</span> <span class="n">color</span><span class="p">;</span>
<span class="linenos">200</span>  <span class="kd">final</span> <span class="n">Paint</span> <span class="n">_paint</span> <span class="o">=</span> <span class="n">Paint</span><span class="p">();</span>
<span class="linenos">201</span>  <span class="kd">final</span> <span class="n">Paint</span> <span class="n">_borderPaint</span> <span class="o">=</span> <span class="n">Paint</span><span class="p">()</span>
<span class="linenos">202</span>    <span class="p">..</span><span class="n">color</span> <span class="o">=</span> <span class="k">const</span> <span class="n">Color</span><span class="p">(</span><span class="mh">0xFFffffff</span><span class="p">)</span>
<span class="linenos">203</span>    <span class="p">..</span><span class="n">style</span> <span class="o">=</span> <span class="n">PaintingStyle</span><span class="p">.</span><span class="n">stroke</span>
<span class="linenos">204</span>    <span class="p">..</span><span class="n">strokeWidth</span> <span class="o">=</span> <span class="m">3</span><span class="p">;</span>
<span class="linenos">205</span>  <span class="kd">final</span> <span class="n">_shadowPaint</span> <span class="o">=</span> <span class="n">Paint</span><span class="p">()</span>
<span class="linenos">206</span>    <span class="p">..</span><span class="n">color</span> <span class="o">=</span> <span class="k">const</span> <span class="n">Color</span><span class="p">(</span><span class="mh">0xFF000000</span><span class="p">)</span>
<span class="linenos">207</span>    <span class="p">..</span><span class="n">maskFilter</span> <span class="o">=</span> <span class="k">const</span> <span class="n">MaskFilter</span><span class="p">.</span><span class="n">blur</span><span class="p">(</span><span class="n">BlurStyle</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span> <span class="m">4.0</span><span class="p">);</span>
<span class="linenos">208</span>  <span class="kd">late</span> <span class="kd">final</span> <span class="n">Path</span> <span class="n">_path</span><span class="p">;</span>
<span class="linenos">209</span>  <span class="kt">bool</span> <span class="n">_isDragged</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="linenos">210</span>
<span class="linenos">211</span>  <span class="nd">@override</span>
<span class="linenos">212</span>  <span class="kt">bool</span> <span class="n">containsLocalPoint</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">point</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">213</span>    <span class="k">return</span> <span class="n">_path</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="n">toOffset</span><span class="p">());</span>
<span class="linenos">214</span>  <span class="p">}</span>
<span class="linenos">215</span>
<span class="linenos">216</span>  <span class="nd">@override</span>
<span class="linenos">217</span>  <span class="kt">void</span> <span class="n">render</span><span class="p">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">218</span>    <span class="k">if</span> <span class="p">(</span><span class="n">_isDragged</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">219</span>      <span class="n">_paint</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">.</span><span class="n">withOpacity</span><span class="p">(</span><span class="m">0.5</span><span class="p">);</span>
<span class="linenos">220</span>      <span class="n">canvas</span><span class="p">.</span><span class="n">drawPath</span><span class="p">(</span><span class="n">_path</span><span class="p">,</span> <span class="n">_paint</span><span class="p">);</span>
<span class="linenos">221</span>      <span class="n">canvas</span><span class="p">.</span><span class="n">drawPath</span><span class="p">(</span><span class="n">_path</span><span class="p">,</span> <span class="n">_borderPaint</span><span class="p">);</span>
<span class="linenos">222</span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos">223</span>      <span class="n">_paint</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">.</span><span class="n">withOpacity</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
<span class="linenos">224</span>      <span class="n">canvas</span><span class="p">.</span><span class="n">drawPath</span><span class="p">(</span><span class="n">_path</span><span class="p">,</span> <span class="n">_shadowPaint</span><span class="p">);</span>
<span class="linenos">225</span>      <span class="n">canvas</span><span class="p">.</span><span class="n">drawPath</span><span class="p">(</span><span class="n">_path</span><span class="p">,</span> <span class="n">_paint</span><span class="p">);</span>
<span class="linenos">226</span>    <span class="p">}</span>
<span class="linenos">227</span>  <span class="p">}</span>
<span class="linenos">228</span>
<span class="linenos">229</span>  <span class="nd">@override</span>
<span class="linenos">230</span>  <span class="kt">void</span> <span class="n">onDragStart</span><span class="p">(</span><span class="n">DragStartEvent</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">231</span>    <span class="n">_isDragged</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="linenos">232</span>    <span class="n">priority</span> <span class="o">=</span> <span class="m">10</span><span class="p">;</span>
<span class="linenos">233</span>  <span class="p">}</span>
<span class="linenos">234</span>
<span class="linenos">235</span>  <span class="nd">@override</span>
<span class="linenos">236</span>  <span class="kt">void</span> <span class="n">onDragEnd</span><span class="p">(</span><span class="n">DragEndEvent</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">237</span>    <span class="n">_isDragged</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="linenos">238</span>    <span class="n">priority</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
<span class="linenos">239</span>  <span class="p">}</span>
<span class="linenos">240</span>
<span class="linenos">241</span>  <span class="nd">@override</span>
<span class="linenos">242</span>  <span class="kt">void</span> <span class="n">onDragUpdate</span><span class="p">(</span><span class="n">DragUpdateEvent</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">243</span>    <span class="n">position</span> <span class="o">+=</span> <span class="n">event</span><span class="p">.</span><span class="n">delta</span><span class="p">;</span>
<span class="linenos">244</span>  <span class="p">}</span>
<span class="linenos">245</span><span class="p">}</span>
<span class="linenos">246</span>
<span class="linenos">247</span><span class="k">const</span> <span class="n">tau</span> <span class="o">=</span> <span class="m">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">;</span>
</pre></div>
</div>
</div>
<button class="flutter-app-button code" onclick="open_code_listings(&quot;flame-examples-source&quot;)">Code</button></section>
<section id="drag-anatomy">
<h2>Drag anatomy<a class="headerlink" href="#drag-anatomy" title="Permalink to this heading">¶</a></h2>
<section id="ondragstart">
<h3>onDragStart<a class="headerlink" href="#ondragstart" title="Permalink to this heading">¶</a></h3>
<p>This is the first event that occurs in a drag sequence. Usually, the event will be delivered to the
topmost component at the point of touch with the <code class="docutils literal notranslate"><span class="pre">DragCallbacks</span></code> mixin. However, by setting the flag
<code class="docutils literal notranslate"><span class="pre">event.continuePropagation</span></code> to true, you can allow the event to propagate to the components below.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">DragStartEvent</span></code> object associated with this event will contain the coordinate of the point
where the event has originated. This point is available in multiple coordinate system:
<code class="docutils literal notranslate"><span class="pre">devicePosition</span></code> is given in the coordinate system of the entire device, <code class="docutils literal notranslate"><span class="pre">canvasPosition</span></code> is in the
coordinate system of the game widget, and <code class="docutils literal notranslate"><span class="pre">localPosition</span></code> provides the position in the component’s
local coordinate system.</p>
<p>Any component that receives <code class="docutils literal notranslate"><span class="pre">onDragStart</span></code> will later be receiving <code class="docutils literal notranslate"><span class="pre">onDragUpdate</span></code> and <code class="docutils literal notranslate"><span class="pre">onDragEnd</span></code>
events as well.</p>
</section>
<section id="ondragupdate">
<h3>onDragUpdate<a class="headerlink" href="#ondragupdate" title="Permalink to this heading">¶</a></h3>
<p>This event is fired continuously as user drags their finger across the screen. It will not fire if
the user is holding their finger still.</p>
<p>The default implementation delivers this event to all the components that received the previous
<code class="docutils literal notranslate"><span class="pre">onDragStart</span></code> with the same pointer id. If the point of touch is still within the component, then
<code class="docutils literal notranslate"><span class="pre">event.localPosition</span></code> will give the position of that point in the local coordinate system. However,
if the user moves their finger away from the component, the property <code class="docutils literal notranslate"><span class="pre">event.localPosition</span></code> will
return a point whose coordinates are NaNs. Likewise, the <code class="docutils literal notranslate"><span class="pre">event.renderingTrace</span></code> in this case will be
empty. However, the <code class="docutils literal notranslate"><span class="pre">canvasPosition</span></code> and <code class="docutils literal notranslate"><span class="pre">devicePosition</span></code> properties of the event will be valid.</p>
<p>In addition, the <code class="docutils literal notranslate"><span class="pre">DragUpdateEvent</span></code> will contain <code class="docutils literal notranslate"><span class="pre">delta</span></code> – the amount the finger has moved since the
previous <code class="docutils literal notranslate"><span class="pre">onDragUpdate</span></code>, or since the <code class="docutils literal notranslate"><span class="pre">onDragStart</span></code> if this is the first drag-update after a drag-
start.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">event.timestamp</span></code> property measures the time elapsed since the beginning of the drag. It can be
used, for example, to compute the speed of the movement.</p>
</section>
<section id="ondragend">
<h3>onDragEnd<a class="headerlink" href="#ondragend" title="Permalink to this heading">¶</a></h3>
<p>This event is fired when the user lifts their finger and thus stops the drag gesture. There is no
position associated with this event.</p>
</section>
<section id="ondragcancel">
<h3>onDragCancel<a class="headerlink" href="#ondragcancel" title="Permalink to this heading">¶</a></h3>
<p>The precise semantics when this event occurs is not clear, so we provide a default implementation
which simply converts this event into an <code class="docutils literal notranslate"><span class="pre">onDragEnd</span></code>.</p>
</section>
</section>
<section id="mixins">
<h2>Mixins<a class="headerlink" href="#mixins" title="Permalink to this heading">¶</a></h2>
<section id="hasdraggablecomponents">
<h3>HasDraggableComponents<a class="headerlink" href="#hasdraggablecomponents" title="Permalink to this heading">¶</a></h3>
<p>This mixin is used on a <code class="docutils literal notranslate"><span class="pre">FlameGame</span></code> in order to ensure that drag events coming from Flutter reach
their target <code class="docutils literal notranslate"><span class="pre">Component</span></code>s. This mixin <strong>must</strong> be added if you have any components with the
<code class="docutils literal notranslate"><span class="pre">DragCallbacks</span></code> mixin.</p>
<p>The mixin adds methods <code class="docutils literal notranslate"><span class="pre">onDragStart</span></code>, <code class="docutils literal notranslate"><span class="pre">onDragUpdate</span></code>, <code class="docutils literal notranslate"><span class="pre">onDragEnd</span></code>, and <code class="docutils literal notranslate"><span class="pre">onDragCancel</span></code> to the game.
The default implementation will simply propagate these events to the component(s) that are at the
point of touch; but you can override them if you also want to respond to those events at the global
game level:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">MyGame</span> <span class="kd">extends</span> <span class="n">FlameGame</span> <span class="kd">with</span> <span class="n">HasDraggableComponents</span> <span class="p">{</span>
  <span class="nd">@override</span>
  <span class="kt">void</span> <span class="n">onDragDown</span><span class="p">(</span><span class="n">DragDownEvent</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">.</span><span class="n">onDragDown</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">event</span><span class="p">.</span><span class="n">handled</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">print</span><span class="p">(</span><span class="s1">&#39;Event </span><span class="si">$</span><span class="n">event</span><span class="s1"> was not handled by any component&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="dragcallbacks">
<h3>DragCallbacks<a class="headerlink" href="#dragcallbacks" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">DragCallbacks</span></code> mixin can be added to any <code class="docutils literal notranslate"><span class="pre">Component</span></code> in order for that component to start
receiving drag events.</p>
<p>This mixin adds methods <code class="docutils literal notranslate"><span class="pre">onDragStart</span></code>, <code class="docutils literal notranslate"><span class="pre">onDragUpdate</span></code>, <code class="docutils literal notranslate"><span class="pre">onDragEnd</span></code>, and <code class="docutils literal notranslate"><span class="pre">onDragCancel</span></code> to the
component, which by default don’t do anything, but can be overridden to implement any real
functionality.</p>
<p>Another crucial detail is that a component will only receive drag events that originate <em>within</em>
that component, as judged by the <code class="docutils literal notranslate"><span class="pre">containsLocalPoint()</span></code> function. The commonly-used
<code class="docutils literal notranslate"><span class="pre">PositionComponent</span></code> class provides such an implementation based on its <code class="docutils literal notranslate"><span class="pre">size</span></code> property. Thus, if
your component derives from a <code class="docutils literal notranslate"><span class="pre">PositionComponent</span></code>, then make sure that you set its size correctly.
If, however, your component derives from the bare <code class="docutils literal notranslate"><span class="pre">Component</span></code>, then the <code class="docutils literal notranslate"><span class="pre">containsLocalPoint()</span></code>
method must be implemented manually.</p>
<p>If your component is a part of a larger hierarchy, then it will only receive drag events if its
ancestors have all implemented the <code class="docutils literal notranslate"><span class="pre">containsLocalPoint</span></code> correctly.</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">MyComponent</span> <span class="kd">extends</span> <span class="n">PositionComponent</span> <span class="kd">with</span> <span class="n">DragCallbacks</span> <span class="p">{</span>
  <span class="n">MyComponent</span><span class="p">({</span><span class="k">super</span><span class="p">.</span><span class="n">size</span><span class="p">});</span>

  <span class="kd">final</span> <span class="n">_paint</span> <span class="o">=</span> <span class="n">Paint</span><span class="p">();</span>
  <span class="kt">bool</span> <span class="n">_isDragged</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="nd">@override</span>
  <span class="kt">void</span> <span class="n">onDragStart</span><span class="p">(</span><span class="n">DragStartEvent</span> <span class="n">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">_isDragged</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

  <span class="nd">@override</span>
  <span class="kt">void</span> <span class="n">onDragUpdate</span><span class="p">(</span><span class="n">DragUpdateEvent</span> <span class="n">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">position</span> <span class="o">+=</span> <span class="n">event</span><span class="p">.</span><span class="n">delta</span><span class="p">;</span>

  <span class="nd">@override</span>
  <span class="kt">void</span> <span class="n">onDragEnd</span><span class="p">(</span><span class="n">DragEndEvent</span> <span class="n">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">_isDragged</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="nd">@override</span>
  <span class="kt">void</span> <span class="n">render</span><span class="p">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">_paint</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">_isDragged</span><span class="o">?</span> <span class="n">Colors</span><span class="p">.</span><span class="n">red</span> <span class="o">:</span> <span class="n">Colors</span><span class="p">.</span><span class="n">white</span><span class="p">;</span>
    <span class="n">canvas</span><span class="p">.</span><span class="n">drawRect</span><span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">toRect</span><span class="p">(),</span> <span class="n">_paint</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="hasdraggablesbridge">
<h3>HasDraggablesBridge<a class="headerlink" href="#hasdraggablesbridge" title="Permalink to this heading">¶</a></h3>
<p>This marker mixin can be used to indicate that the game has both the “new-style” components that
use the <code class="docutils literal notranslate"><span class="pre">DragCallbacks</span></code> mixin, and the “old-style” components that use the <code class="docutils literal notranslate"><span class="pre">Draggable</span></code> mixin. In
effect, every drag event will be propagated twice through the system: first trying to reach the
components with <code class="docutils literal notranslate"><span class="pre">DragCallbacks</span></code> mixin, and then components with <code class="docutils literal notranslate"><span class="pre">Draggable</span></code>.</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">MyGame</span> <span class="kd">extends</span> <span class="n">FlameGame</span> <span class="kd">with</span> <span class="n">HasDraggableComponents</span><span class="p">,</span> <span class="n">HasDraggablesBridge</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The purpose of this mixin is to ease the transition from the old event delivery system to the
new one. With this mixin, you can transition your <code class="docutils literal notranslate"><span class="pre">Draggable</span></code> components into using <code class="docutils literal notranslate"><span class="pre">DragCallbacks</span></code>
one by one, verifying that your game continues to work at every step.</p>
<p>Use of this mixin for any new project is highly discouraged.</p>
</section>
</section>
</section>


    </div>
    <div class="copyright">
      The content on this page is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0 License</a>,
      and code samples under the <a href="https://raw.githubusercontent.com/flame-engine/flame/main/LICENSE">MIT License</a>.
    </div>
    <div class="prev-next-area">
      <a class="left-prev" id="prev-link" href="tap-events.html" title="previous page">
        <i class="fa fa-angle-left"></i>
        <div class="prev-next-info">
          <p class="prev-next-subtitle">Previous:</p>
          <p class="prev-next-title">Tap events</p>
        </div>
      </a>
      <div class='expander'></div>
      <a class="right-next" id="next-link" href="gesture-input.html" title="next page">
        <div class="prev-next-info">
          <p class="prev-next-subtitle">Next:</p>
          <p class="prev-next-title">Gesture Input</p>
        </div>
        <i class="fa fa-angle-right"></i>
      </a>
    </div>
  </div>

  <div class="sidebar-right">
    
    <div class="nav-right" role="navigation" aria-label="table of contents">
      <div id='toc-local' class='list-group'>
 <div class='header'><i class='fa fa-list'></i> Contents</div>
  <a href='#demo' class='list-group-item level-1'>Demo</a>
  <a href='#drag-anatomy' class='list-group-item level-1'>Drag anatomy</a>
  <a href='#ondragstart' class='list-group-item level-2'>onDragStart</a>
  <a href='#ondragupdate' class='list-group-item level-2'>onDragUpdate</a>
  <a href='#ondragend' class='list-group-item level-2'>onDragEnd</a>
  <a href='#ondragcancel' class='list-group-item level-2'>onDragCancel</a>
  <a href='#mixins' class='list-group-item level-1'>Mixins</a>
  <a href='#hasdraggablecomponents' class='list-group-item level-2'>HasDraggableComponents</a>
  <a href='#dragcallbacks' class='list-group-item level-2'>DragCallbacks</a>
  <a href='#hasdraggablesbridge' class='list-group-item level-2'>HasDraggablesBridge</a>
</div>

    </div>
  </div>

  <div class="expander"></div>
</div>




</body>
</html>