<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>2. Scaffolding &#8212; Flame</title>
  <!-- Stylesheets -->
  <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/basic.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/dart_domain.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/flutter_app.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/package.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/yarn_lexer.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/flames.css" />
  <!-- Scripts -->
  <script src="../../_static/jquery.js"></script>
  <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
  <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
  <script src="../../_static/doctools.js"></script>
  <script src="../../_static/sphinx_highlight.js"></script>
  <script src="../../_static/flutter_app.js"></script>
  <script src="../../_static/clipboard.min.js"></script>
  <script src="../../_static/copybutton.js"></script>
  <script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({startOnLoad:true});</script>
  <script src="../../_static/versions.js"></script>
  <script src="../../_static/menu-expand.js"></script>
  <!--script src="searchindex.js" defer></script-->
  <!-- Links -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,400;0,700;1,400;1,700&display=swap">
  <link rel="preload" as="font" type="font/woff2" crossorigin="" href="../../_static/fontawesome/fa-brands-400.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin="" href="../../_static/fontawesome/fa-solid-900.woff2">
  <link rel="stylesheet" href="../../_static/fontawesome/all.min.css">
  <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="next" title="Other Modules" href="../../other_modules/other_modules.html" />
  <link rel="prev" title="1. Preparation" href="step1.html" />
</head>

<body data-spy="scroll" data-target="#toc-local" data-offset="80">

<div class="top-bar">
  <button id="menu-button" class="btn" title="Toggle menu"><i class="fa fa-bars"></i></button>
  <script type="text/javascript">
    jQuery(function(){
      $("#menu-button").click(function() {
        $(this).toggleClass("active");
        $(".sidebar-left-area").toggleClass("active");
      });

      $('div.nav-left li > a:not(:only-child)').wrap('<div class=submenu></div>');
      $('div.nav-left div.submenu').prepend('<a class=arrow>&nbsp;</a>');
      $('div.nav-left div.submenu > a.arrow')
        .click(function() {
          $(this.parentElement.parentElement).toggleClass('current');
        });

      // This function ensures that when navigating to internal targets within the page (such as
      // a section header), those targets will be visible to the user and not obscured by the menu
      // bar at the top of the page.
      function scrollToHashTarget() {
        if (location.hash !== location.oldHash) {
          window.scrollBy(0, -60);
          location.oldHash = location.hash;
        }
      }
      window.location.oldHash = '';
      window.addEventListener('hashchange', scrollToHashTarget);
      scrollToHashTarget();
    });
  </script>

  <a href="../../index.html" class="logo_image">
    <img src="../../_static/logo_flame.png">
  </a>  
  <div class="highlight-box" role="alert" style="display:none">
    <div>
      <div class="title">highlighted:</div>
      <div class="content" id="highlight-content"></div>
    </div>
    <button type="button" class="close" data-dismiss="alert" aria-label="Dismiss">×</button>
  </div>
  <div class="expander"></div>

  <div class="versions-placeholder"></div>
  <a href="https://discord.com/invite/pxrBmy4" id="discord-button" class="btn"
     title="Blue Fire Discord server">
    <i class="fab fa-discord"></i>
  </a>
  <a href="https://github.com/flame-engine/flame/" id="github-button" class="btn"
     title="GitHub repository">
    <i class="fab fa-github"></i>
  </a>
</div>

<div class="sidebar-left-area">
  <div class="sidebar-left-bg"></div>
  <div class="sidebar-left">
    <div class="searchbox" role="search">
      <form id="search-form" action="../../search.html" method="get">
        <i class="icon fa fa-search"></i>
        <input type="search" class="form-control" id="search-input" name="q"
               placeholder="Search the docs..." autocomplete="off" />
      </form>
    </div>
    <div class="nav-left" role="navigation" aria-label="Main">
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../flame/flame.html">flame</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../flame/structure.html">File structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/game.html">Game loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/components.html">Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/platforms.html">Platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/collision_detection.html">Collision detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/effects.html">Effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/camera_and_viewport.html">Camera &amp; Viewport</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/camera_component.html">Camera component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/inputs/inputs.html">Inputs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../flame/inputs/gesture-input.html">Gesture input</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/inputs/keyboard-input.html">Keyboard input</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/inputs/other-inputs.html">Other inputs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/rendering/rendering.html">Rendering</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../flame/rendering/images.html">Images, sprites and animations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/rendering/text.html">Text rendering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/rendering/palette.html">Colors and palette</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/rendering/particles.html">Particles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/rendering/layers.html">Layers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../flame/other/other.html">Other</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../flame/other/debug.html">Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/other/util.html">Utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flame/other/widgets.html">Widgets</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../flame_audio/flame_audio.html">flame_audio</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../flame_audio/audio.html">General audio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flame_audio/bgm.html">Background music</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../bare_flame_game.html">Bare Flame game</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="klondike.html">Klondike</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="step1.html">1. Preparation</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2. Scaffolding</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../other_modules/other_modules.html">Other Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../other_modules/forge2d.html">Forge2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_modules/oxygen.html">Oxygen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_modules/tiled.html">Tiled</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_modules/splash_screen.html">Splash screen</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
</div>

<div class="main-area">
  <div class="document-wrapper">
    <div class="warning hidden" id="version-warning">
      <p><strong>Warning:</strong> you are currently viewing the docs for an older
      version <span class="version"></span> of Flame.</p>
      <p>Please <a href="/">click here</a> to go see the documentation for the latest
      released version.</p>
    </div>
    <div class="document" role="main">
      
  <section class="tex2jax_ignore mathjax_ignore" id="scaffolding">
<h1>2. Scaffolding<a class="headerlink" href="#scaffolding" title="Permalink to this heading">¶</a></h1>
<p>In this section we will use broad strokes in order to outline the main elements
of the game. This includes the main game class, and the general layout.</p>
<section id="klondikegame">
<h2>KlondikeGame<a class="headerlink" href="#klondikegame" title="Permalink to this heading">¶</a></h2>
<p>In Flame universe, the <code class="docutils literal notranslate"><span class="pre">FlameGame</span></code> class is the cornerstone of any game. This
class runs the game loop, dispatches events, owns all the components that
comprise the game (the component tree), and usually also serves as the central
repository for the game’s state.</p>
<p>So, create a new file called <code class="docutils literal notranslate"><span class="pre">klondike_game.dart</span></code> inside the <code class="docutils literal notranslate"><span class="pre">lib/</span></code> folder, and
declare the <code class="docutils literal notranslate"><span class="pre">KlondikeGame</span></code> class inside:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:flame/game.dart&#39;</span><span class="p">;</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">KlondikeGame</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">FlameGame</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">onLoad</span><span class="p">()</span><span class="w"> </span><span class="kd">async</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">await</span><span class="w"> </span><span class="n">Images</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;klondike-sprites.png&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For now we only declared the <code class="docutils literal notranslate"><span class="pre">onLoad</span></code> method, which is a special handler that
is called when the game instance is attached to the Flutter widget tree for the
first time. You can think of it as a delayed asynchronous constructor.
Currently, the only thing that <code class="docutils literal notranslate"><span class="pre">onLoad</span></code> does is that it loads the sprites image
into the game; but we will be adding more soon. Any image or other resource that
you want to use in the game needs to be loaded first, which is a relatively slow
I/O operation, hence the need for <code class="docutils literal notranslate"><span class="pre">await</span></code> keyword.</p>
<p>Let’s incorporate this class into the project so that it isn’t orphaned. Open
the <code class="docutils literal notranslate"><span class="pre">main.dart</span></code> find the line which says <code class="docutils literal notranslate"><span class="pre">final</span> <span class="pre">game</span> <span class="pre">=</span> <span class="pre">FlameGame();</span></code> and replace
the <code class="docutils literal notranslate"><span class="pre">FlameGame</span></code> with <code class="docutils literal notranslate"><span class="pre">KlondikeGame</span></code>. You will need to import the class too.
After all is done, the file should look like this:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:flame/game.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:flutter/widgets.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;klondike_game.dart&#39;</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KlondikeGame</span><span class="p">();</span>
<span class="w">  </span><span class="n">runApp</span><span class="p">(</span><span class="n">GameWidget</span><span class="p">(</span><span class="nl">game:</span><span class="w"> </span><span class="n">game</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="other-classes">
<h2>Other classes<a class="headerlink" href="#other-classes" title="Permalink to this heading">¶</a></h2>
<p>So far we have the main <code class="docutils literal notranslate"><span class="pre">KlondikeGame</span></code> class, and now we need to create objects
that we will add to the game. In Flame these objects are called <em>components</em>,
and when added to the game they form a “game component tree”. All entities that
exist in the game must be components.</p>
<p>As we already mentioned in the previous chapter, our game mainly consists of
<code class="docutils literal notranslate"><span class="pre">Card</span></code> components. However, since drawing the cards will take some effort, we
will defer implementation of that class to the next chapter.</p>
<p>For now, let’s create the container classes, as shown on the sketch. These are:
<code class="docutils literal notranslate"><span class="pre">Stock</span></code>, <code class="docutils literal notranslate"><span class="pre">Waste</span></code>, <code class="docutils literal notranslate"><span class="pre">Pile</span></code> and <code class="docutils literal notranslate"><span class="pre">Foundation</span></code>. In your project directory create a
sub-directory <code class="docutils literal notranslate"><span class="pre">components</span></code>, and then the file <code class="docutils literal notranslate"><span class="pre">components/stock.dart</span></code>. In that
file write</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:flame/components.dart&#39;</span><span class="p">;</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">Stock</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">PositionComponent</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="kd">get</span><span class="w"> </span><span class="n">debugMode</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here we declare the <code class="docutils literal notranslate"><span class="pre">Stock</span></code> class as a <code class="docutils literal notranslate"><span class="pre">PositionComponent</span></code> (which is a component
that has a position and size). We also turn on the debug mode for this class so
that we can see it on the screen even though we don’t have any rendering logic
yet.</p>
<p>Likewise, create three more files <code class="docutils literal notranslate"><span class="pre">components/foundation.dart</span></code>,
<code class="docutils literal notranslate"><span class="pre">components/pile.dart</span></code>, and <code class="docutils literal notranslate"><span class="pre">components/waste.dart</span></code>. For now all four classes
will have exactly the same logic inside, we’ll be adding more functionality into
those classes in subsequent chapters.</p>
</section>
<section id="game-structure">
<h2>Game structure<a class="headerlink" href="#game-structure" title="Permalink to this heading">¶</a></h2>
<p>Once we have some basic components, they need to be added to the game. It is
time to make a decision about the high-level structure of the game.</p>
<p>There exist multiple approaches here, which differ in their complexity,
extendability, and overall philosophy. The approach that we will be taking in
this tutorial is based on using the <a class="reference internal" href="../../flame/camera_component.html#world"><span class="std std-ref">World</span></a> component, together with a <a class="reference internal" href="../../flame/camera_component.html#cameracomponent"><span class="std std-ref">Camera</span></a>.</p>
<p>The idea behind this approach is the following: imagine that your game world
exists independently from the device, that it exists already in our heads, and
on the sketch, even though we haven’t done any coding yet. This world will have
a certain size, and each element in the world will have certain coordinates. It
is up to us to decide what will be the size of the world, and what is the unit
of measurement for that size. The important part is that the world exists
independently from the device, and its dimensions likewise do not depend on the
pixel resolution of the screen.</p>
<p>All elements that are part of the world will be added to the <code class="docutils literal notranslate"><span class="pre">World</span></code> component,
and the <code class="docutils literal notranslate"><span class="pre">World</span></code> component will be then added to the game.</p>
<p>The second part of the overall structure is a camera (<code class="docutils literal notranslate"><span class="pre">CameraComponent</span></code>). The
purpose of the camera is to be able to look at the world, to make sure that it
renders at the right size on the screen of the user’s device.</p>
<p>Thus, the overall structure of the component tree will look approximately like
this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>KlondikeGame
 ├─ World
 │   ├─ Stock
 │   ├─ Waste
 │   ├─ Foundation (×4)
 │   └─ Pile (×7)
 └─ CameraComponent
</pre></div>
</div>
<p>For this game I’ve been drawing my image assets having in mind the dimension of
a single card at 1000×1400 pixels. So, this will serve as the reference size for
determining the overall layout. Another important measurement that affects the
layout is the inter-card distance. It seems like it should be somewhere between
150 to 200 units (relative to the card width), so we will declare it as a
variable <code class="docutils literal notranslate"><span class="pre">cardGap</span></code> that can be adjusted later if needed. For simplicity, both
the vertical and horizontal inter-card distance will be the same, and the
minimum padding between the cards and the edges of the screen will also be equal
to <code class="docutils literal notranslate"><span class="pre">cardGap</span></code>.</p>
<p>Alright, let’s put all this together and implement our <code class="docutils literal notranslate"><span class="pre">KlondikeGame</span></code> class:</p>
<div class="highlight-dart notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span><span class="w"> </span><span class="nc">KlondikeGame</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">FlameGame</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">cardGap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">175.0</span><span class="p">;</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">cardWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000.0</span><span class="p">;</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">cardHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1400.0</span><span class="p">;</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">onLoad</span><span class="p">()</span><span class="w"> </span><span class="kd">async</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">await</span><span class="w"> </span><span class="n">images</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;klondike-sprites.png&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">stock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stock</span><span class="p">()</span>
<span class="w">      </span><span class="p">..</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector2</span><span class="p">(</span><span class="n">cardWidth</span><span class="p">,</span><span class="w"> </span><span class="n">cardHeight</span><span class="p">)</span>
<span class="w">      </span><span class="p">..</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector2</span><span class="p">(</span><span class="n">cardGap</span><span class="p">,</span><span class="w"> </span><span class="n">cardGap</span><span class="p">);</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">waste</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Waste</span><span class="p">()</span>
<span class="w">      </span><span class="p">..</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector2</span><span class="p">(</span><span class="n">cardWidth</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1.5</span><span class="p">,</span><span class="w"> </span><span class="n">cardHeight</span><span class="p">)</span>
<span class="w">      </span><span class="p">..</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector2</span><span class="p">(</span><span class="n">cardWidth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cardGap</span><span class="p">,</span><span class="w"> </span><span class="n">cardGap</span><span class="p">);</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">foundations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span>
<span class="w">      </span><span class="m">4</span><span class="p">,</span>
<span class="w">      </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Foundation</span><span class="p">()</span>
<span class="w">        </span><span class="p">..</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector2</span><span class="p">(</span><span class="n">cardWidth</span><span class="p">,</span><span class="w"> </span><span class="n">cardHeight</span><span class="p">)</span>
<span class="w">        </span><span class="p">..</span><span class="n">position</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">Vector2</span><span class="p">((</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">cardWidth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cardGap</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cardGap</span><span class="p">,</span><span class="w"> </span><span class="n">cardGap</span><span class="p">),</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">piles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span>
<span class="w">      </span><span class="m">7</span><span class="p">,</span>
<span class="w">      </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Pile</span><span class="p">()</span>
<span class="w">        </span><span class="p">..</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector2</span><span class="p">(</span><span class="n">cardWidth</span><span class="p">,</span><span class="w"> </span><span class="n">cardHeight</span><span class="p">)</span>
<span class="w">        </span><span class="p">..</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector2</span><span class="p">(</span>
<span class="w">          </span><span class="n">cardGap</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">cardWidth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cardGap</span><span class="p">),</span>
<span class="w">          </span><span class="n">cardHeight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cardGap</span><span class="p">,</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">world</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">World</span><span class="p">()</span>
<span class="w">      </span><span class="p">..</span><span class="n">add</span><span class="p">(</span><span class="n">stock</span><span class="p">)</span>
<span class="w">      </span><span class="p">..</span><span class="n">add</span><span class="p">(</span><span class="n">waste</span><span class="p">)</span>
<span class="w">      </span><span class="p">..</span><span class="n">addAll</span><span class="p">(</span><span class="n">foundations</span><span class="p">)</span>
<span class="w">      </span><span class="p">..</span><span class="n">addAll</span><span class="p">(</span><span class="n">piles</span><span class="p">);</span>
<span class="w">    </span><span class="n">add</span><span class="p">(</span><span class="n">world</span><span class="p">);</span>

<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CameraComponent</span><span class="p">(</span><span class="nl">world:</span><span class="w"> </span><span class="n">world</span><span class="p">)</span>
<span class="w">      </span><span class="p">..</span><span class="n">viewfinder</span><span class="p">.</span><span class="n">visibleGameSize</span><span class="w"> </span><span class="o">=</span>
<span class="w">          </span><span class="n">Vector2</span><span class="p">(</span><span class="n">cardWidth</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cardGap</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cardHeight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cardGap</span><span class="p">)</span>
<span class="w">      </span><span class="p">..</span><span class="n">viewfinder</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector2</span><span class="p">(</span><span class="n">cardWidth</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">3.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cardGap</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
<span class="w">      </span><span class="p">..</span><span class="n">viewfinder</span><span class="p">.</span><span class="n">anchor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Anchor</span><span class="p">.</span><span class="n">topCenter</span><span class="p">;</span>
<span class="w">    </span><span class="n">add</span><span class="p">(</span><span class="n">camera</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Let’s review what’s happening here:</p>
<ul>
<li><p>First, we declare constants <code class="docutils literal notranslate"><span class="pre">cardWidth</span></code>, <code class="docutils literal notranslate"><span class="pre">cardHeight</span></code>, and <code class="docutils literal notranslate"><span class="pre">cardGap</span></code> which
describe the size of a card and the distance between cards.</p></li>
<li><p>Then, there is the <code class="docutils literal notranslate"><span class="pre">onLoad</span></code> method that we have had before. It starts with
loading the main image asset, as before (though we are not using it yet).</p></li>
<li><p>After that, we create components <code class="docutils literal notranslate"><span class="pre">stock</span></code>, <code class="docutils literal notranslate"><span class="pre">waste</span></code>, etc., setting their size
and position in the world. The positions are calculated using simple
arithmetics.</p></li>
<li><p>Then we create the main <code class="docutils literal notranslate"><span class="pre">World</span></code> component, add to it all the components
that we just created, and finally add the <code class="docutils literal notranslate"><span class="pre">world</span></code> to the game.</p></li>
<li><p>Lastly, we create a camera object to look at the <code class="docutils literal notranslate"><span class="pre">world</span></code>. Internally, the
camera consists of two parts: a viewport and a viewfinder. The default
viewport is <code class="docutils literal notranslate"><span class="pre">MaxViewport</span></code>, which takes up the entire available screen size –
this is exactly what we need for our game, so no need to change anything. The
viewfinder, on the other hand, needs to be set up to properly take into
account the dimensions of the underlying world.</p>
<ul>
<li><p>We want the entire card layout to be visible on the screen without the
need to scroll. In order to accomplish this, we specify that we want the
entire world size (which is <code class="docutils literal notranslate"><span class="pre">7*cardWidth</span> <span class="pre">+</span> <span class="pre">8*cardGap</span></code> by
<code class="docutils literal notranslate"><span class="pre">4*cardHeight</span> <span class="pre">+</span> <span class="pre">3*cardGap</span></code>) to be able to fit into the screen. The
<code class="docutils literal notranslate"><span class="pre">.visibleGameSize</span></code> setting ensures that no matter the size of the device,
the zoom level will be adjusted such that the specified chunk of the game
world will be visible.</p>
<ul class="simple">
<li><p>The game size calculation is obtained like this: there are 7 cards in
the tableau and 6 gaps between them, add 2 more “gaps” to account for
padding, and you get the width of <code class="docutils literal notranslate"><span class="pre">7*cardWidth</span> <span class="pre">+</span> <span class="pre">8*cardGap</span></code>.
Vertically, there are two rows of cards, but in the bottom row we
need some extra space to be able to display a tall pile – by my
rough estimate, thrice the height of a card is sufficient for this –
which gives the total height of the game world as
<code class="docutils literal notranslate"><span class="pre">4*cardHeight</span> <span class="pre">+</span> <span class="pre">3*cardGap</span></code>.</p></li>
</ul>
</li>
<li><p>Next, we specify which part of the world will be in the “center” of the
viewport. In this case I specify that the “center” of the viewport should
be at the top center of the screen, and the corresponding point within
the game world is at coordinates <code class="docutils literal notranslate"><span class="pre">[(7*cardWidth</span> <span class="pre">+</span> <span class="pre">8*cardGap)/2,</span> <span class="pre">0]</span></code>.</p>
<p>The reason for such choice for the viewfinder’s position and anchor is
because of how we want it to respond if the game size becomes too wide or
too tall: in case of too wide we want it to be centered on the screen,
but if the screen is too tall, we want the content to be aligned at the
top.</p>
</li>
</ul>
</li>
<li><p>As a side note, you may be wondering when you need to <code class="docutils literal notranslate"><span class="pre">await</span></code> the result
of <code class="docutils literal notranslate"><span class="pre">add()</span></code>, and when you don’t.</p>
<p>The short answer is: usually you don’t need to wait, but if you want to, then
it won’t hurt either.</p>
<p>If you check the documentation for <code class="docutils literal notranslate"><span class="pre">.add()</span></code> method, you’ll see that the
returned future only waits until the component is finished loading, not until
it is actually mounted to the game. As such, you only have to wait for the
future from <code class="docutils literal notranslate"><span class="pre">.add()</span></code> if your logic requires that the component is fully
loaded before it can proceed. This is not very common.</p>
<p>If you don’t <code class="docutils literal notranslate"><span class="pre">await</span></code> the future from <code class="docutils literal notranslate"><span class="pre">.add()</span></code>, then the component will be
added to the game anyways, and in the same amount of time.</p>
</li>
</ul>
<p>If you run the game now, you should see the placeholders for where the various
components will be. If you are running the game in the browser, try resizing the
window and see how the game responds to this.</p>
<p>And this is it with this step – we’ve created the basic game structure upon
which everything else will be built. In the next step, we’ll learn how to render
the card objects, which are the most important visual objects in this game.</p>
<button class="flutter-app-button popup" onclick="run_flutter_app(&quot;/1.1.0/_static/apps/tutorials-klondike-app/index.html?step2&quot;)">Run</button></section>
</section>


    </div>
    <div class="copyright">
      The content on this page is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0 License</a>,
      and code samples under the <a href="https://raw.githubusercontent.com/flame-engine/flame/main/LICENSE">MIT License</a>.
    </div>
    <div class="prev-next-area">
      <a class="left-prev" id="prev-link" href="step1.html" title="previous page">
        <i class="fa fa-angle-left"></i>
        <div class="prev-next-info">
          <p class="prev-next-subtitle">Previous:</p>
          <p class="prev-next-title">1. Preparation</p>
        </div>
      </a>
      <div class='expander'></div>
      <a class="right-next" id="next-link" href="../../other_modules/other_modules.html" title="next page">
        <div class="prev-next-info">
          <p class="prev-next-subtitle">Next:</p>
          <p class="prev-next-title">Other Modules</p>
        </div>
        <i class="fa fa-angle-right"></i>
      </a>
    </div>
  </div>

  <div class="sidebar-right">
    
    <div class="nav-right" role="navigation" aria-label="table of contents">
      <div id='toc-local' class='list-group'>
 <div class='header'><i class='fa fa-list'></i> Contents</div>
  <a href='#klondikegame' class='list-group-item level-1'>KlondikeGame</a>
  <a href='#other-classes' class='list-group-item level-1'>Other classes</a>
  <a href='#game-structure' class='list-group-item level-1'>Game structure</a>
</div>

    </div>
  </div>

  <div class="expander"></div>
</div>




</body>
</html>